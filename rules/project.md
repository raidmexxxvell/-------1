# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã: –õ–∏–≥–∞ –û–±–Ω–∏–Ω—Å–∫–∞ (–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

> –î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏: 2025-09-04  
> –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è `app.py`: ~9750 —Å—Ç—Ä–æ–∫ (–¥–æ–±–∞–≤–ª–µ–Ω retry –¥–ª—è my-bets, etag_json —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è, –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–µ —Ö–µ–ª–ø–µ—Ä—ã splashStages).  
> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: persistent roster (`team_roster`), –ø—É–±–ª–∏—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç lineups, —á–∞—Å—Ç–∏—á–Ω–∞—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è match-details —á–µ—Ä–µ–∑ `fetchMatchDetails`, –º–∏–≥—Ä–∞—Ü–∏—è schedule/results –Ω–∞ `fetchEtag`, —á–∏—Å–ª–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å splash (stage API), UI —Ñ–∏–∫—Å—ã –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞, –ø–∏–ª–æ—Ç–Ω—ã–π DB retry.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app.py                      # –û—Å–Ω–æ–≤–Ω–æ–µ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–º–æ–Ω–æ–ª–∏—Ç, –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é)
‚îú‚îÄ‚îÄ config.py                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ wsgi.py                     # WSGI-—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è production
‚îú‚îÄ‚îÄ requirements.txt            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ render.yaml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –Ω–∞ Render
‚îú‚îÄ‚îÄ api/                        # API –º–∞—Ä—à—Ä—É—Ç—ã (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py               # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ betting.py             # API —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.py          # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ security_test.py       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ core/                      # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ database/                  # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ database_api.py        # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ database_models.py     # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ database_schema.sql    # SQL —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ security.py            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py          # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (auth, rate limiting)
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.py          # –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py          # Middleware –¥–ª—è Flask
‚îÇ   ‚îú‚îÄ‚îÄ betting.py             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ sheets.py              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets
‚îú‚îÄ‚îÄ optimizations/             # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ multilevel_cache.py    # –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ background_tasks.py    # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ websocket_manager.py   # WebSocket –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ smart_invalidator.py   # –£–º–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
‚îÇ   ‚îî‚îÄ‚îÄ optimized_sheets.py    # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Sheets
‚îú‚îÄ‚îÄ scripts/                   # –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ init_database.py       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ static/                    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/                   # –°—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ style.css          # –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blb.css            # –¢–µ–º–∞ BLB League
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ splash.css         # –°—Ç–∏–ª–∏ splash-—ç–∫—Ä–∞–Ω–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database-ui.css    # –°—Ç–∏–ª–∏ –¥–ª—è –ë–î –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ js/                    # JavaScript –º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.js         # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ predictions.js     # –ú–æ–¥—É–ª—å —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ league.js          # –õ–∏–≥–∞ –∏ —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js           # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ realtime-updates.js # Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile-*.js       # –ú–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram-patch.js  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
‚îÇ   ‚îî‚îÄ‚îÄ img/                   # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∏–∫–æ–Ω–∫–∏
‚îî‚îÄ‚îÄ templates/                 # HTML —à–∞–±–ª–æ–Ω—ã
    ‚îú‚îÄ‚îÄ index.html             # –û—Å–Ω–æ–≤–Ω–æ–π —à–∞–±–ª–æ–Ω SPA
    ‚îî‚îÄ‚îÄ admin_dashboard.html   # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–æ)

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ **–º–æ–¥—É–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:
- **API Layer**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ –¥–æ–º–µ–Ω–∞–º (betting, admin, monitoring)
- **Business Logic Layer**: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `app.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –≤ `utils/`
- **Data Layer**: –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (`database/`)
- **Optimization Layer**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Frontend**: –ú–æ–¥—É–ª—å–Ω–∞—è JavaScript –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|--------|------------|
| **Backend Framework** | Flask | 2.3.3 | –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| **Database** | PostgreSQL | - | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î (—á–µ—Ä–µ–∑ SQLAlchemy 2.0.36) |
| **ORM** | SQLAlchemy | 2.0.36 | –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö |
| **Cache** | Redis | 5.0.1 | –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à (in-memory + Redis) |
| **WebSockets** | Flask-SocketIO | 5.3.6 | Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è |
| **External API** | Google Sheets API | gspread 6.0.0 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ |
| **Authentication** | Telegram WebApp | - | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram |
| **Security** | Various | - | Rate limiting, CSRF, validation |
| **Deployment** | Gunicorn | 21.2.0 | Production WSGI —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ wsgi.py) |
| **Migrations** | Alembic | 1.13.2 | –ú–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ–¥–∫–ª—é—á–µ–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏) |
| **Sanitize** | Bleach | 6.1.0 | –û—á–∏—Å—Ç–∫–∞ HTML (–ø–ª–∞–Ω: –Ω–æ–≤–æ—Å—Ç–∏) |
| **Rate Limit** | flask-limiter | 3.5.0 | –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **Monitoring** | psutil | 5.9.8 | –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **Frontend** | Vanilla JS | ES6+ | –ë–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ |
| **Styling** | CSS3 | - | Custom CSS —Å —Ç–µ–º–∏–∑–∞—Ü–∏–µ–π |

### –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **Python 3.12+** - Backend
- **JavaScript ES6+** - Frontend
- **CSS3** - –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **SQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **HTML5** - –†–∞–∑–º–µ—Ç–∫–∞

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –Ω–æ–≤—ã–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã

–ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (Q3 2025):
1. –°–µ–∑–æ–Ω–Ω—ã–π ¬´deep reset¬ª (dry / soft / full / deep): —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.
2. –û—á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ B,D —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ Google Sheets –ø—Ä–∏ deep reset (—Å—Ç—Ä–æ–∫–∏ 2..300).
3. CRUD –Ω–æ–≤–æ—Å—Ç–µ–π + –ø—É–±–ª–∏—á–Ω—ã–π `/api/news` (–∫—ç—à + ETag MD5) + –ø—Ä–æ–≥—Ä–µ–≤.
4. –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–æ–≤–æ—Å—Ç–∏, —Å–µ–∑–æ–Ω–Ω—ã–π —Å–±—Ä–æ—Å).
5. –ü–æ–º–æ—â–Ω–∏–∫ `_get_news_session()` –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ `DatabaseManager`.
6. Snapshot —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `/api/stats-table` (ETag + fallback –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ / —Å–æ–±—ã—Ç–∏–π).
7. `invalidate_pattern` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞ (e.g. `cache:news`).
8. ETag —Ç–∞–∫–∂–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.
9. Persistent roster (`team_roster`): —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ –∫–æ–º–∞–Ω–¥—ã —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π (case-insensitive) –∏ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ç—á–µ–≤–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞.

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API

```python
# api/betting.py - –ü—Ä–∏–º–µ—Ä –º–æ–¥—É–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
def init_betting_routes(app, get_db, SessionLocal, User, Bet, 
                       parse_and_verify_telegram_init_data, 
                       _build_betting_tours_payload, ...):
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å—Ç–∞–≤–æ–∫ —Å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
    
    @betting_bp.route('/place', methods=['POST'])
    def api_betting_place():
        """–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏"""
        try:
            parsed = parse_and_verify_telegram_init_data(request.form.get('initData', ''))
            if not parsed or not parsed.get('user'):
                return jsonify({'error': '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'}), 401
            
            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
            return jsonify({'status': 'success'})
        except Exception as e:
            app.logger.error(f"Betting place error: {e}")
            return jsonify({'error': '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞–≤–∫—É'}), 500
```

### 2. –°–∏—Å—Ç–µ–º–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# utils/decorators.py
@app.route('/api/betting/place', methods=['POST'])
@require_telegram_auth()
@rate_limit(max_requests=5, time_window=60)
@validate_input(
    initData={'type':'string','required':True,'min_length':1},
    market={'type':'string','required':True,'min_length':1},
    stake='int'
)
def api_betting_place():
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ –ø–æ–ª—É—á–∞–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    pass
```

### 3. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–∞—Å—à–∏—Ä–µ–Ω–æ)

–ê–ª–≥–æ—Ä–∏—Ç–º now:
1. Memory (TTL per type) ‚Üí —Å–≤–µ–∂–æ? –≤–µ—Ä–Ω—É—Ç—å.
2. Redis (pickle) ‚Üí hydrate memory.
3. Loader (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω) ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–∞ —É—Ä–æ–≤–Ω—è.
4. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ—á–µ—á–Ω–∞—è (`invalidate`) –∏ –ø–æ —à–∞–±–ª–æ–Ω—É (`invalidate_pattern`).

TTL –ø—Ä–∏–º–µ—Ä—ã: league_table 300s/1800s, news 120s/300s.

–ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –≤—ã–∑—ã–≤–∞–µ—Ç: –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è `cache:news` + –ø—Ä–æ–≥—Ä–µ–≤ `limit:5:offset:0`.

### 3a. ETag –ø–æ–≤–µ—Ä—Ö –∫—ç—à–∞
–ü—É–±–ª–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è (sorted keys, UTF-8) ‚Üí MD5 ‚Üí `ETag`. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `If-None-Match`, —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç 304.

### 4. –ü–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–∞–∫—Ç—É–∞–ª–µ–Ω)

```python
# database/database_models.py
class Tournament(Base):
    __tablename__ = 'tournaments'
    
    id = Column(Integer, primary_key=True)
    name = Column(String(255), nullable=False)
    season = Column(String(100), nullable=False)
    status = Column(String(50), default='active')
    
    # Relationships
    matches = relationship("Match", back_populates="tournament")
```

### 5. –ú–æ–¥—É–ª—å–Ω–∞—è JavaScript –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```javascript
// static/js/profile.js - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
(() => {
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter –¥–ª—è fetch –∑–∞–ø—Ä–æ—Å–æ–≤
    const originalFetch = window.fetch.bind(window);
    const cfg = Object.assign({ tokensPerSec: 20, bucketCapacity: 20 }, 
                              window.__FETCH_LIMITS__ || {});
    
    // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è fetch —Å rate limiting
    window.fetch = (input, init) => new Promise((resolve, reject) => {
        queue.push({ run: () => originalFetch(input, init).then(resolve, reject) });
        schedule();
    });
})();

## üîÑ –ù–µ–¥–∞–≤–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–µ–Ω—Ç—è–±—Ä—å 2025)

### 2025-09-04
- Splash —ç–∫—Ä–∞–Ω: –¥–æ–±–∞–≤–ª–µ–Ω —á–∏—Å–ª–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (0‚Äì100%) –ø–æ–¥ –ø–æ–ª–æ—Å–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
- –í–≤–µ–¥—ë–Ω stage API `window.splashStages` (profile ‚Üí 70%, data ‚Üí 90%, finish ‚Üí 100%) + `setSplashProgress` –¥–ª—è —Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏.
- –£—Å—Ç—Ä–∞–Ω—ë–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª: —É–±—Ä–∞–Ω—ã full-bleed —Å—Ç–∏–ª–∏ —É `.subtabs`, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã `profile-top-area`, –∏–Ω—Å–µ—Ç –¥–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
- UI: —É–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ ¬´–ù–æ–≤–æ—Å—Ç–∏¬ª, –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–æ–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã –Ω–∏–∂–Ω–µ–º—É –º–µ–Ω—é.
- –ß–∞—Å—Ç–∏—á–Ω–∞—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è match-details: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `league.js` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ `fetchMatchDetails` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω fallback –¥–ª—è legacy –∑–æ–Ω).
- –ú–∏–≥—Ä–∞—Ü–∏—è `/api/schedule` –∏ `/api/results` –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π `fetchEtag` (–∫–ª–∏–µ–Ω—Ç). –°–µ—Ä–≤–µ—Ä–Ω—ã–π `etag_json` –¥–ª—è –Ω–∏—Ö ‚Äî –≤ –ø–ª–∞–Ω–µ.
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∏–ª–æ—Ç–Ω—ã–π retry (OperationalError / SSL EOF) –¥–ª—è `/api/betting/my-bets`: dispose engine ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–æ—Å–Ω–æ–≤–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ helper).

### 2025-09-03
- –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ SPA: `profile.js` –≤—ã–∑—ã–≤–∞–µ—Ç `loadNews()` –Ω–∞ `DOMContentLoaded`.
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª (`profile-achievements.js`), —É–±—Ä–∞–Ω—ã placeholder'—ã.
- –°—Ç–∏–ª–∏: `.achv-desc`, `.achv-desc-toggle`, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.
- –£–ª—É—á—à–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.

–≠—Ç–∏ –ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ã—à–∞—é—Ç UX (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–µ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º), —É–º–µ–Ω—å—à–∞—é—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π —à—É–º –∏ –≥–æ—Ç–æ–≤—è—Ç –ø–æ—á–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è splashStages –≤ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö).
```

## üé® UI/UX –∏ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –ü–æ–¥—Ö–æ–¥—ã –∫ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

1. **CSS Custom Properties (CSS Variables)**
```css
:root {
    /* UFO League Theme (default) */
    --bg: #0f1720;
    --card: #111827;
    --accent1: linear-gradient(135deg, #ffb86b, #6c8cff);
    --primary: #6c8cff;
    --transition: all 0.3s ease;
}

/* BLB League Theme */
body.blb-theme {
    --bg: #0a1128;
    --accent1: linear-gradient(135deg, #7a5f26, #eebb11);
    --primary: #eebb11;
}
```

2. **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∏–ª–µ–π**
- `style.css` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ —Ç–µ–º—ã
- `splash.css` - —Å—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞  
- `blb.css` - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è BLB –ª–∏–≥–∏
- `database-ui.css` - —Å—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω**
```css
body {
    touch-action: manipulation; /* –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ pinch-zoom */
    padding: 16px 0 64px; /* –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π */
    min-height: 100vh;
}

@media (max-width: 768px) {
    /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
}
```

### –¢–µ–º–∏–∑–∞—Ü–∏—è
–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Å–º–µ–Ω—É —Ç–µ–º**:
- **UFO League** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
- **BLB League** - –∑–æ–ª–æ—Ç–∏—Å—Ç–æ-—Å–∏–Ω—è—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ç–µ–º–∞

### –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (a11y)
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ HTML5
- ARIA-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

## ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### –°–∏—Å—Ç–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# utils/security.py
class InputValidator:
    TEAM_NAME_PATTERN = re.compile(r'^[–∞-—è–ê-–Øa-zA-Z0-9\s\-_\.]{1,50}$')
    SCORE_PATTERN = re.compile(r'^\d{1,2}:\d{1,2}$')
    
    @classmethod
    def validate_team_name(cls, name: str) -> tuple[bool, str]:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã"""
        if not name or not isinstance(name, str):
            return False, "Team name is required"
        # ... –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        return True, name
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
# utils/middleware.py
class ErrorHandlingMiddleware:
    def __init__(self, app):
        self.app = app
        self.app.register_error_handler(Exception, self.handle_exception)
    
    def handle_exception(self, e):
        """–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        return jsonify({'error': 'Internal server error'}), 500
```

### Rate Limiting

```python
# utils/decorators.py
def rate_limit(max_requests: int = 100, time_window: int = 60):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤"""
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Redis
            if not rate_limiter.is_allowed(request.remote_addr, max_requests, time_window):
                return jsonify({'error': 'Too many requests'}), 429
            return f(*args, **kwargs)
        return decorated_function
    return decorator
```

### –ö–∞—á–µ—Å—Ç–≤–æ JavaScript –∫–æ–¥–∞

- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **Throttling –¥–ª—è UI —Å–æ–±—ã—Ç–∏–π** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ spam-–∫–ª–∏–∫–æ–≤
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –≤ localStorage —Å TTL

## üîß –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### 1. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫ (Betting System)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–∏—Ö —Å—Ç–∞–≤–æ–∫

```python
# –ü—Ä–∏–º–µ—Ä —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
@app.route('/api/betting/place', methods=['POST'])
@require_telegram_auth()
@rate_limit(max_requests=5, time_window=60)
def api_betting_place():
    market = request.form.get('market', '1x2')  # 1x2, totals, penalty, redcard
    selection = request.form.get('selection', '')  # home, draw, away, over_X, under_X
    stake = int(request.form.get('stake', 0))
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤
    if stake < BET_MIN_STAKE or stake > BET_MAX_STAKE:
        return jsonify({'error': f'–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç {BET_MIN_STAKE} –¥–æ {BET_MAX_STAKE}'}), 400
```

**API**:
- `POST /api/betting/place` - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
- `GET /api/betting/tours` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ç—á–µ–π
- `POST /api/betting/my-bets` - –∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–∞–º–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-09-03, –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞–º–∏ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```javascript
// static/js/admin-enhanced.js - –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
function updateTeamLineup(team){
    const textarea = document.getElementById(`${team}-main-lineup-input`);
    const lines = textarea.value.split('\n').map(l=>l.trim()).filter(Boolean);
    if(!lines.length){ showToast('–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤','error'); return; }
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–µ–π
    const counts = lines.reduce((a,l)=>{const k=l.toLowerCase();a[k]=(a[k]||0)+1;return a;},{});
    const dups = Object.entries(counts).filter(([_,c])=>c>1).map(([k])=>k);
    if(dups.length){ textarea.classList.add('has-dup'); showToast('–î—É–±–ª–∏–∫–∞—Ç—ã: '+dups.join(', '),'error',6000); return; }
    textarea.classList.remove('has-dup');
    currentLineups[team].main = lines.map(name => ({ name })); // —Ç–æ–ª—å–∫–æ –∏–º—è
    textarea.value='';
    renderLineups();
}
```

**–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–∞–∫—Ç—É–∞–ª—å–Ω–æ)**:
- –£–±—Ä–∞–Ω –ª–æ–≥–æ—Ç–∏–ø –∏–∑ header –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (–±–æ–ª—å—à–µ —Ä–∞–±–æ—á–µ–π –ø–ª–æ—â–∞–¥–∏)
- –ú–∞—Å—Å–æ–≤—ã–π –≤–≤–æ–¥ —Å–æ—Å—Ç–∞–≤–æ–≤ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω–æ—á–Ω—ã–π textarea (bulk paste)
- –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã –±–µ–∑ –∑–∞–ø–∞—Å–Ω—ã—Ö (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞)
- Inline –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–µ–π (case-insensitive) + –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
- Toast‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ alert (–Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–π UX)
- WebSocket —Å–æ–±—ã—Ç–∏–µ `lineups_updated` –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π push)
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–∞—Ç—á (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π fetch)
- Persistent roster: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ç—á–µ–≤—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `team_roster` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö, —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å–∫–ª—é—á—ë–Ω–Ω—ã—Ö)
- Fallback –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ —É –º–∞—Ç—á–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑ `team_roster`
- –ù–æ–≤–∞—è —Ç–æ—á–∫–∞ `GET /api/match/lineups?match_id=...` (DB-first) –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –∏–º–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (trim + collapse spaces + lower) –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ç—Ä–æ–∫ (CSS –∫–ª–∞—Å—Å `has-dup` / `dup-player`)

**API / Realtime (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)**:
- `POST /api/admin/match/{id}/lineups/save` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (emit `lineups_updated` + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `team_roster`)
- `POST /api/admin/match/{id}/lineups` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –º–∞—Ç—á–µ–≤—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ (—Å fallback –∫ `team_roster`)
- `GET /api/match/lineups?match_id=...` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã (match-specific –∏–ª–∏ fallback roster)
- WebSocket: —Å–æ–±—ã—Ç–∏–µ `lineups_updated` ‚Üí –∫–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `GET /api/match/lineups` (DB-first, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Sheets)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–∞ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ lower –¥–ª—è –∫–ª—é—á–µ–π, —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

### 3. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏ Google Sheets API

```python
class MultiLevelCache:
    def get(self, cache_type: str, identifier: str = '', loader_func: Optional[Callable] = None):
        # –£—Ä–æ–≤–µ–Ω—å 1: Memory cache (—Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)
        if cache_type in ['league_table', 'schedule']:
            memory_data = self._get_from_memory(cache_type, identifier)
            if memory_data and not self._is_expired(memory_data):
                return memory_data['value']
        
        # –£—Ä–æ–≤–µ–Ω—å 2: Redis cache (—Å—Ä–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ)
        if self.redis_client:
            redis_data = self._get_from_redis(cache_type, identifier)
            if redis_data:
                return redis_data
        
        # –£—Ä–æ–≤–µ–Ω—å 3: Database/Sheets (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
        if loader_func:
            fresh_data = loader_func()
            self._set_cache(cache_type, identifier, fresh_data)
            return fresh_data
```

### 3. Telegram WebApp Integration

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

```javascript
// static/js/telegram-patch.js
const tg = window.Telegram?.WebApp;

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebApp
tg.ready();
tg.expand();
tg.enableClosingConfirmation();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ back button –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
tg.BackButton.onClick(() => {
    const streamPane = document.getElementById('md-pane-stream');
    if (streamPane && streamPane.classList.contains('fs-mode')) {
        streamPane.classList.remove('fs-mode');
        enableSwipes();
    }
});
```

### 4. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```python
# optimizations/websocket_manager.py
class WebSocketManager:
    def notify_data_change(self, data_type: str, data: dict = None):
        """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
        message = {
            'type': 'data_update',
            'data_type': data_type,  # 'league_table', 'match_score', etc.
            'timestamp': data.get('updated_at', ''),
            'data': data
        }
        self.socketio.emit('data_update', message, broadcast=True)
```

### 5. –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 6. –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
–ê–¥–º–∏–Ω CRUD: `GET/POST/PUT/DELETE /api/admin/news` (Telegram initData + —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `ADMIN_USER_ID`).  
–ü—É–±–ª–∏—á–Ω–æ–µ API: `GET /api/news?limit=5&offset=0` (–∫—ç—à + ETag).  
–ö–ª—é—á–∏ –∫—ç—à–∞: `cache:news:limit:{L}:offset:{O}`.  
–ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–∏: `invalidate_pattern('cache:news')` + –ø—Ä–æ–≥—Ä–µ–≤ –±–∞–∑–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.

–ü—Ä–∏–º–µ—Ä –ø—É–±–ª–∏—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
```json
{"news":[{"id":1,"title":"–°—Ç–∞—Ä—Ç —Å–µ–∑–æ–Ω–∞","content":"...","created_at":"2025-09-02T10:00:00Z"}],"version":"md5hash"}
```

### 7. –°–µ–∑–æ–Ω–Ω—ã–π deep reset
–†–µ–∂–∏–º—ã: dry (–∞—É–¥–∏—Ç), soft (–ª—ë–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–µ–π), full (–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö), deep (full + —á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ Sheets + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ + –ø—Ä–æ–≥—Ä–µ–≤).  
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏–º–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–¥–æ ~300 —Å—Ç—Ä–æ–∫) –∏ –≤—ã–±–æ—Ä–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ B,D (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).

### 8. Snapshot —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
`/api/stats-table` ‚Üí –µ—Å–ª–∏ snapshot –Ω–∞–π–¥–µ–Ω ‚Üí –æ—Ç–¥–∞—ë–º —Å ETag, –∏–Ω–∞—á–µ —Å–æ–±–∏—Ä–∞–µ–º –∏–∑ –∏–≥—Ä–æ–∫–æ–≤/—Å–æ–±—ã—Ç–∏–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—è–∂—ë–ª—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é.

### 9. ETag –ø–∞—Ç—Ç–µ—Ä–Ω
–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON (sort_keys) ‚Üí md5 ‚Üí `ETag` + `Cache-Control: public, max-age=120, stale-while-revalidate=60` (–Ω–æ–≤–æ—Å—Ç–∏) / –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

### 10. –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞
–ü–æ—Å–ª–µ CRUD –Ω–æ–≤–æ—Å—Ç–µ–π –∏ deep reset ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ–≤ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ä–µ–∑–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
# utils/security.py
class TelegramSecurity:
    def verify_init_data(self, init_data: str, bot_token: str) -> Optional[Dict]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram WebApp"""
        try:
            parsed = parse_qs(init_data)
            hash_value = parsed.get('hash', [''])[0]
            
            # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
            data_check_string = '\n'.join([f"{k}={v[0]}" for k, v in sorted(parsed.items()) if k != 'hash'])
            
            # –í—ã—á–∏—Å–ª—è–µ–º HMAC
            secret_key = hashlib.sha256(bot_token.encode()).digest()
            expected_hash = hmac.new(secret_key, data_check_string.encode(), hashlib.sha256).hexdigest()
            
            return expected_hash == hash_value
        except Exception:
            return False
```

## üìã –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

1. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ö–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
2. **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - rate limiting, –≤–∞–ª–∏–¥–∞—Ü–∏—è, CSRF –∑–∞—â–∏—Ç–∞
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WebApp API
5. **Real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - WebSocket –¥–ª—è –∂–∏–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
6. **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—Ç–∞–≤–æ–∫ –∏ —Ä—ã–Ω–∫–æ–≤

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–æ)

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```python
   # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
   def test_betting_place():
       """–¢–µ—Å—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏"""
       with app.test_client() as client:
           response = client.post('/api/betting/place', data={
               'market': '1x2',
               'selection': 'home',
               'stake': 100
           })
           assert response.status_code == 200
   ```

2. **TypeScript –º–∏–≥—Ä–∞—Ü–∏—è** —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API** (OpenAPI via apispec / flask-smorest).
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏** + –∫–æ—Ä–µ–ª–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
5. **CI/CD**: GitHub Actions (lint, tests, security scan).
6. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è app.py** –Ω–∞ –º–æ–¥—É–ª–∏ (news, season_reset, snapshots, auth).
7. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º** (Pydantic / Marshmallow) –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
8. **Sanitization (bleach)** –¥–ª—è HTML –≤ –Ω–æ–≤–æ—Å—Ç—è—Ö.
9. **Alembic —Ä–µ–≤–∏–∑–∏–∏** ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É.
10. **Feature flags** —á–µ—Ä–µ–∑ ENV –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º.
11. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º—ë–Ω –∏–≥—Ä–æ–∫–æ–≤ (–≤—ã–Ω–µ—Å—Ç–∏ helper –≤–º–µ—Å—Ç–æ inline –∫–æ–¥–∞ –≤ endpoint —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–æ–≤).
12. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π helper –¥–ª—è DB retry/backoff (–ø–∏–ª–æ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ –æ–±–æ–±—â–∏—Ç—å + —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É).
13. –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–º–µ–Ω—É legacy –±–ª–æ–∫–æ–≤ match-details –Ω–∞ `fetchMatchDetails` (–ø–æ–∏—Å–∫ –ø–æ —Ä–µ–ø–æ: —Å—Ç–∞—Ä—ã–µ –ø—Ä—è–º—ã–µ fetch –∫ `/api/match-details`).
14. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π `etag_json` –∫ `/api/schedule`, `/api/results`, `/api/match-details`.
15. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã `splashStages.profile/data/finish` –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π (achievements, schedule, results, lineups) –≤–º–µ—Å—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞.

### –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
**Senior-friendly** - –ø—Ä–æ–µ–∫—Ç —Ç—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –°–∏—Å—Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Integration —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
- Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

1. **–ú–æ–Ω–æ–ª–∏—Ç app.py** ~9.6K —Å—Ç—Ä–æ–∫.
2. **Sheets –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ) ‚Äî –Ω—É–∂–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API + –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤ –ë–î.
3. **Retry / backoff** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
4. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞** ‚Äî —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —Å—Ç–æ–∏—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å.
5. **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (—Ñ–∏–∫—Å—Ç—É—Ä—ã Redis/Sheets).
6. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç Alembic —Ä–µ–≤–∏–∑–∏–∏** (—Ä–∏—Å–∫ –¥—Ä–µ–π—Ñ–∞ —Å—Ö–µ–º—ã) ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã `team_roster` (—Å–æ–∑–¥–∞—ë—Ç—Å—è ad-hoc).
7. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sanitization –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π** (XSS —Ä–∏—Å–∫ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ).
8. inline DDL (CREATE TABLE IF NOT EXISTS team_roster) –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—é.

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------------|------------|------------|
| `DATABASE_URL` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ PostgreSQL | –î–∞ |
| `REDIS_URL` | Redis –¥–ª—è –∫—ç—à–∞ | –ù–µ—Ç (fallback memory) |
| `BOT_TOKEN` | Telegram Bot —Ç–æ–∫–µ–Ω | –î–∞ |
| `ADMIN_USER_ID` | Telegram ID —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞ | –î–∞ |
| `GOOGLE_SHEETS_KEY`/creds | –î–æ—Å—Ç—É–ø –∫ Sheets | –î–∞ (–¥–ª—è –∏–º–ø–æ—Ä—Ç–∞) |
| `SEASON_RESET_LOCK_TTL` | TTL –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ reset (–æ–ø—Ü.) | –ù–µ—Ç |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
```bash
pip install -r requirements.txt
export DATABASE_URL=postgresql+psycopg://user:pass@host/db
export BOT_TOKEN=123:abc
export ADMIN_USER_ID=123456789
python app.py  # –∏–ª–∏ gunicorn -w 1 -k geventwebsocket.gunicorn.workers.GeventWebSocketWorker wsgi:app
```

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- News CRUD ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ.
- ETag `/api/news`, `/api/stats-table` ‚Äî —É—á—Ç–µ–Ω–æ.
- Deep reset ‚Äî –æ–ø–∏—Å–∞–Ω.
- –ü—Ä–æ–≥—Ä–µ–≤ –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–æ.
- DatabaseManager (lazy) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ.
- Alembic ‚Äî –æ—Ç–º–µ—á–µ–Ω–æ (–Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω).

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ç–æ–ø‚Äë5)
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é match-details (–≤—Å–µ –≤—ã–∑–æ–≤—ã ‚Üí `fetchMatchDetails`) –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å `etag_json` –∫ schedule/results/match-details.
2. –í—ã–Ω–µ—Å—Ç–∏ news / reset / snapshots / roster (lineups) –∏–∑ `app.py` (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–æ–Ω–æ–ª–∏—Ç–∞).
3. –î–æ–±–∞–≤–∏—Ç—å bleach-sanitization –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π (XSS –∑–∞—â–∏—Ç–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏—á–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–æ–º).
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Alembic –∏ –ø–µ—Ä–≤—É—é —Ä–µ–≤–∏–∑–∏—é (–≤–∫–ª—é—á–∞—è `team_roster`).
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI (lint + pytest stub) + –∫–∞—Ä–∫–∞—Å –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤ —Å—Ç–∞–≤–æ–∫.
6. (–°–≤—è–∑–∞–Ω–æ) –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DB retry/backoff helper –∏ –∑–∞–º–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–∏–ª–æ—Ç–∞.
7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è splashStages —Å–æ —Å—Ç–∞–¥–∏—è–º–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (—É–±—Ä–∞—Ç—å ¬´—Ñ–∏–∫—Ç–∏–≤–Ω—ã–π¬ª –ø—Ä–æ–≥—Ä–µ—Å—Å —Ç–∞–º –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ).

---

–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **enterprise-—É—Ä–æ–≤–µ–Ω—å** —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

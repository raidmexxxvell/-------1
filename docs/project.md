# –ê–Ω–∞–ª–∏–∑ –∫–æ–¥–æ–≤–æ–π –±–∞–∑—ã: –õ–∏–≥–∞ –û–±–Ω–∏–Ω—Å–∫–∞ (–ê–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

> –î–∞—Ç–∞ –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏–∏: 2025-09-07  
> –¢–µ–∫—É—â–∞—è –≤–µ—Ä—Å–∏—è `app.py`: ~9750 —Å—Ç—Ä–æ–∫ (etag_json —Ä–∞—Å—à–∏—Ä–µ–Ω, /api/match-details –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ etag_json, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DB retry helper –¥–ª—è —á—Ç–µ–Ω–∏–π, –¥–æ–±–∞–≤–ª–µ–Ω—ã ETag-–º–µ—Ç—Ä–∏–∫–∏, cap –¥–ª—è –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤, X-Updated-At –∏ admin refresh).  
> –ü–æ—Å–ª–µ–¥–Ω–∏–µ –∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è: persistent roster (`team_roster`), –ø—É–±–ª–∏—á–Ω—ã–π —ç–Ω–¥–ø–æ–∏–Ω—Ç lineups, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è match-details —á–µ—Ä–µ–∑ `etag_json` (server) –∏ `fetchMatchDetails` (client), –º–∏–≥—Ä–∞—Ü–∏—è schedule/results –Ω–∞ `etag_json` (server) –∏ `fetchEtag` (client), —á–∏—Å–ª–æ–≤–æ–π –ø—Ä–æ–≥—Ä–µ—Å—Å splash (stage API), UI —Ñ–∏–∫—Å—ã –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–æ–≥–æ —Å–∫—Ä–æ–ª–ª–∞, —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DB retry –¥–ª—è `/api/betting/my-bets`, –ø–µ—Ä–µ–Ω–æ—Å ¬´–¶–µ–ª–∏¬ª –≤ —Ä–∞–∑–¥–µ–ª–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π –≤–Ω—É—Ç—Ä—å ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª, –æ—Ä–∫–µ—Å—Ç—Ä–∞—Ü–∏—è —Å–∫—Ä—ã—Ç–∏—è splash –ø–æ —Å–æ–±—ã—Ç–∏—è–º –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏ (news/ads/topmatch), —Å–Ω–∏–∂–µ–Ω–∏–µ —à—É–º–∞ –ª–æ–≥–æ–≤ –¥–ª—è –æ—Ç—Å—É—Ç—Å—Ç–≤—É—é—â–∏—Ö –º–∞—Ç—á–µ–π –≤ —Ä–∞—Å—á—ë—Ç–µ —Ç–æ—Ç–∞–ª–æ–≤ (INFO –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–∞—Ä—É –∫–æ–º–∞–Ω–¥).

–î–æ–ø–æ–ª–Ω–µ–Ω–∏—è (UX/Realtime):
- –ö–ª–∏–∫ –ø–æ –∫–æ–º–∞–Ω–¥–µ –≤ –ü—Ä–æ–≥–Ω–æ–∑–∞—Ö –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç —ç–∫—Ä–∞–Ω –∫–æ–º–∞–Ω–¥—ã: –≥–ª–æ–±–∞–ª—å–Ω—ã–π –¥–µ–ª–µ–≥–∞—Ç –ø–µ—Ä–µ–≤–æ–¥–∏—Ç –Ω–∞ –≤–∫–ª–∞–¥–∫—É ¬´–õ–∏–≥–∞¬ª –∏ –≤—ã–∑—ã–≤–∞–µ—Ç `TeamPage.openTeam(name)` (profile-team.js).
- –≠–∫—Ä–∞–Ω –∫–æ–º–∞–Ω–¥—ã `#ufo-team` —Å–∫—Ä—ã–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∏–∂–Ω–∏—Ö –≤–∫–ª–∞–¥–æ–∫ –∏ –ø–æ–¥–≤–∫–ª–∞–¥–æ–∫ –ù–õ–û, —á—Ç–æ–±—ã –Ω–µ ¬´–ø—Ä–∏–ª–∏–ø–∞—Ç—å¬ª –ø–æ–¥ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ–º (profile.js).
- –ü—Ä–∏ live‚Äë–∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—á—ë—Ç–∞ (`POST /api/match/score/set`) –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –ª—ë–≥–∫–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è `league_table` –∏ `schedule` —á–µ—Ä–µ–∑ SmartInvalidator (–±–µ–∑ –ø–µ—Ä–µ—Å—á—ë—Ç–∞/—Ä–∞—Å—á—ë—Ç–∞ —Å—Ç–∞–≤–æ–∫). –ö–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–∞–±–ª–∏—Ü—É —á–µ—Ä–µ–∑ `RealtimeUpdater` ‚Üí `League.refreshTable()`.
 - –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã: –µ—Å–ª–∏ –≤ –∞–∫—Ç–∏–≤–Ω–æ–º —Å–µ–∑–æ–Ω–µ –µ—â—ë –Ω–µ—Ç –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –º–∞—Ç—á–µ–π, `/api/league-table` —Å–æ–±–∏—Ä–∞–µ—Ç —Å–æ—Å—Ç–∞–≤ —É—á–∞—Å—Ç–Ω–∏–∫–æ–≤ –∏–∑ snapshot `schedule` –∏ –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç –¥–æ 9 –∫–æ–º–∞–Ω–¥ —Å –Ω—É–ª–µ–≤–æ–π —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–æ–π (PTS/GD = 0), —á—Ç–æ–±—ã —Ç–∞–±–ª–∏—Ü–∞ –Ω–µ –±—ã–ª–∞ –ø—É—Å—Ç–æ–π.
 - –ñ–∏–≤–∞—è —Ç–∞–±–ª–∏—Ü–∞ –≤–æ –≤—Ä–µ–º—è –º–∞—Ç—á–∞: –∫–ª–∏–µ–Ω—Ç —Å–ø–µ—Ä–≤–∞ –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç `/api/league-table/live` (Cache-Control: no-store); –ø—Ä–∏ 404/–æ—à–∏–±–∫–µ –ø–∞–¥–∞–µ—Ç –Ω–∞ –æ–±—ã—á–Ω—É—é `/api/league-table`. Live‚Äë–ø—Ä–æ–µ–∫—Ü–∏—è –Ω–∞–∫–ª–∞–¥—ã–≤–∞–µ—Ç —Ç–µ–∫—É—â–∏–µ —Å—á—ë—Ç–∞ –∏–∑ `MatchScore` –Ω–∞ –±–∞–∑–æ–≤—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é –∏ –ø–æ–º–µ—á–∞–µ—Ç payload –ø–æ–ª–µ–º `live: true`.

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ app.py                      # –û—Å–Ω–æ–≤–Ω–æ–µ Flask-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ (–º–æ–Ω–æ–ª–∏—Ç, –∫–∞–Ω–¥–∏–¥–∞—Ç –Ω–∞ –¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—é)
‚îú‚îÄ‚îÄ config.py                   # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ wsgi.py                     # WSGI-—Ç–æ—á–∫–∞ –≤—Ö–æ–¥–∞ –¥–ª—è production
‚îú‚îÄ‚îÄ requirements.txt            # Python –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ render.yaml                 # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –¥–µ–ø–ª–æ—è –Ω–∞ Render
‚îú‚îÄ‚îÄ api/                        # API –º–∞—Ä—à—Ä—É—Ç—ã (–º–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)
‚îÇ   ‚îú‚îÄ‚îÄ admin.py               # –ê–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îú‚îÄ‚îÄ betting.py             # API —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.py          # –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ —Å–∏—Å—Ç–µ–º—ã
‚îÇ   ‚îî‚îÄ‚îÄ security_test.py       # –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ core/                      # –Ø–¥—Ä–æ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ database/                  # –°–ª–æ–π —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ database_api.py        # API –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å PostgreSQL
‚îÇ   ‚îú‚îÄ‚îÄ database_models.py     # SQLAlchemy –º–æ–¥–µ–ª–∏
‚îÇ   ‚îî‚îÄ‚îÄ database_schema.sql    # SQL —Å—Ö–µ–º–∞ –ë–î
‚îú‚îÄ‚îÄ utils/                     # –£—Ç–∏–ª–∏—Ç—ã –∏ —Ö–µ–ª–ø–µ—Ä—ã
‚îÇ   ‚îú‚îÄ‚îÄ security.py            # –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ decorators.py          # –î–µ–∫–æ—Ä–∞—Ç–æ—Ä—ã (auth, rate limiting)
‚îÇ   ‚îú‚îÄ‚îÄ monitoring.py          # –°–∏—Å—Ç–µ–º–∞ –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥–∞
‚îÇ   ‚îú‚îÄ‚îÄ middleware.py          # Middleware –¥–ª—è Flask
‚îÇ   ‚îú‚îÄ‚îÄ betting.py             # –£—Ç–∏–ª–∏—Ç—ã –¥–ª—è —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îî‚îÄ‚îÄ sheets.py              # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Google Sheets
‚îú‚îÄ‚îÄ optimizations/             # –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
‚îÇ   ‚îú‚îÄ‚îÄ multilevel_cache.py    # –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à
‚îÇ   ‚îú‚îÄ‚îÄ background_tasks.py    # –§–æ–Ω–æ–≤—ã–µ –∑–∞–¥–∞—á–∏
‚îÇ   ‚îú‚îÄ‚îÄ websocket_manager.py   # WebSocket –º–µ–Ω–µ–¥–∂–µ—Ä
‚îÇ   ‚îú‚îÄ‚îÄ smart_invalidator.py   # –£–º–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞
‚îÇ   ‚îî‚îÄ‚îÄ optimized_sheets.py    # –û–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–∞—è —Ä–∞–±–æ—Ç–∞ —Å Sheets
‚îú‚îÄ‚îÄ scripts/                   # –°–∫—Ä–∏–ø—Ç—ã –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏
‚îÇ   ‚îî‚îÄ‚îÄ init_database.py       # –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –ë–î
‚îú‚îÄ‚îÄ static/                    # –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–µ —Ñ–∞–π–ª—ã
‚îÇ   ‚îú‚îÄ‚îÄ css/                   # –°—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ style.css          # –û—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ blb.css            # –¢–µ–º–∞ BLB League
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ splash.css         # –°—Ç–∏–ª–∏ splash-—ç–∫—Ä–∞–Ω–∞
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ database-ui.css    # –°—Ç–∏–ª–∏ –¥–ª—è –ë–î –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
‚îÇ   ‚îú‚îÄ‚îÄ js/                    # JavaScript –º–æ–¥—É–ª–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile.js         # –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ predictions.js     # –ú–æ–¥—É–ª—å —Å—Ç–∞–≤–æ–∫
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ league.js          # –õ–∏–≥–∞ –∏ —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ admin.js           # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ realtime-updates.js # Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ profile-*.js       # –ú–æ–¥—É–ª—å–Ω—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø—Ä–æ—Ñ–∏–ª—è
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ telegram-patch.js  # –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram WebApp
‚îÇ   ‚îî‚îÄ‚îÄ img/                   # –ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è –∏ –∏–∫–æ–Ω–∫–∏
‚îî‚îÄ‚îÄ templates/                 # HTML —à–∞–±–ª–æ–Ω—ã
    ‚îú‚îÄ‚îÄ index.html             # –û—Å–Ω–æ–≤–Ω–æ–π —à–∞–±–ª–æ–Ω SPA
    ‚îî‚îÄ‚îÄ admin_dashboard.html   # –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å
```

### –ü—Ä–∏–Ω—Ü–∏–ø—ã –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –∫–æ–¥–∞ (–∞–∫—Ç—É–∞–ª—å–Ω–æ)

## üß≠ –ë—ã—Å—Ç—Ä–∞—è –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Ñ—É–Ω–∫—Ü–∏—è–º (–∫—É–¥–∞ —Å–º–æ—Ç—Ä–µ—Ç—å –≤ –∫–æ–¥–µ)

- Real-time –∏ —Ç–æ–ø–∏–∫–∏
    - Server batching/patch: `optimizations/websocket_manager.py` ‚Üí –º–µ—Ç–æ–¥—ã `emit_to_topic_batched`, `get_metrics`
    - –ü—É–±–ª–∏–∫–∞—Ü–∏—è —Å–æ–±—ã—Ç–∏–π: `optimizations/smart_invalidator.py` ‚Üí `publish_topic`, Redis –∫–∞–Ω–∞–ª `app:topic`
    - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –ø—Ä–∏—ë–º –ø–∞—Ç—á–µ–π: `static/js/realtime-updates.js` ‚Üí –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `data_patch`
    - –§–∏—á–µ—Ñ–ª–∞–≥–∏ WS: —á—Ç–µ–Ω–∏–µ –≤ `templates/index.html`, –ª–æ–≥–∏–∫–∞ pre-probe –≤ `static/js/profile.js`

- –°—Ç–∞–≤–∫–∏ –∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
    - –†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏: `app.py` ‚Üí `/api/betting/place`
    - –õ–µ–Ω—Ç—ã —Ç—É—Ä–æ–≤/–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤: `app.py` ‚Üí `/api/betting/tours` (–¥–æ–±–∞–≤–ª—è–µ—Ç `odds_version`)
    - –í–µ—Ä—Å–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤: `app.py` ‚Üí `_get_odds_version`, `_bump_odds_version`
    - –ü–æ–ª–∏—Ç–∏–∫–∞ –æ–∫—Ä—É–≥–ª–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤: —Å–µ—Ä–≤–µ—Ä –≤—ã—á–∏—Å–ª—è–µ—Ç –∏ —Ñ–æ—Ä–º–∞—Ç–∏—Ä—É–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã —Å —Ç–æ—á–Ω–æ—Å—Ç—å—é 2 –∑–Ω–∞–∫–∞ –ø–æ –ø—Ä–∞–≤–∏–ª—É ROUND_HALF_UP (Decimal), –∫–ª–∏–µ–Ω—Ç –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç —á–µ—Ä–µ–∑ `toFixed(2)`. –í ¬´–ú–æ–∏ —Å—Ç–∞–≤–∫–∏¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç, –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –Ω–∞ –º–æ–º–µ–Ω—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏ (—Å—Ç—Ä–æ–∫–∞), —á—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç —Ä–∞—Å—Å–∏–Ω—Ö—Ä–æ–Ω –≤–∏–¥–∞ 1.63 vs 1.62.
    - –ö–ª–∏–µ–Ω—Ç (—Å—Ç–∞–≤–∫–∏): `static/js/predictions.js` (WS + ETag‚Äëfallback –ø—É–ª–ª–∏–Ω–≥ 3.5‚Äì4.7—Å)

- –î–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞ –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
    - –°–µ—Ä–≤–µ—Ä–Ω—ã–π ETag: `app.py` ‚Üí `/api/match-details` —á–µ—Ä–µ–∑ `etag_json`
    - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–π –∑–∞–≥—Ä—É–∑—á–∏–∫: `static/js/match-details-fetch.js` ‚Üí `window.fetchMatchDetails`
    - –ü—É–ª–ª–∏–Ω–≥ —Å—Ç–∞—Ç–æ–≤: `static/js/profile-match-stats.js` (10‚Äì15—Å, ETag)
    - –ê–Ω—Ç–∏‚Äë—Ñ–ª–∏–∫–µ—Ä –ø–æ—Å–ª–µ –∞–¥–º–∏–Ω—Å–∫–∏—Ö –ø—Ä–∞–≤–æ–∫: `static/js/profile-match-advanced.js`

- –õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã –∏ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è
    - –°–µ—Ä–≤–µ—Ä–Ω—ã–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã (ETag): `app.py` ‚Üí `/api/leaderboard/*`, `/api/achievements`
    - API `/api/achievements`: –¥–æ–±–∞–≤–ª–µ–Ω–æ –ø–æ–ª–µ `best_tier` (–Ω–∞–∏–≤—ã—Å—à–∏–π –¥–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å), —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã `all_targets` –∏ `next_target` –¥–ª—è –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–≥–æ –ø—Ä–æ–≥—Ä–µ—Å—Å–∞.
    - –ö–ª–∏–µ–Ω—Ç—Å–∫–∏–µ –≤—ã–∑–æ–≤—ã: `static/js/profile.js` (leaderboards) –∏ `static/js/profile-achievements.js`
    - –†–µ–Ω–¥–µ—Ä –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π: –±–µ–π–¥–∂ (–∏–∫–æ–Ω–∫–∞/—Ü–≤–µ—Ç) –æ–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è –ø–æ `best_tier`; —Å–ø–∏—Å–æ–∫ ¬´–¶–µ–ª–∏: <all_targets.join('/')>¬ª –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ —Å–µ–∫—Ü–∏–∏ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª (—Å–∫—Ä—ã—Ç –≤ –∫—Ä–∞—Ç–∫–æ–º –æ–ø–∏—Å–∞–Ω–∏–∏); –ø—Ä–æ–≥—Ä–µ—Å—Å –æ—Å—Ç–∞—ë—Ç—Å—è –≤ –∫—Ä–∞—Ç–∫–æ–π —á–∞—Å—Ç–∏ –∫–∞–∫ `value/next_target`.
    - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–∞—è —É—Ç–∏–ª–∏—Ç–∞ SWR/ETag: `static/js/etag-fetch.js`
    - –ü–æ–≤–µ–¥–µ–Ω–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è: –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã –æ–±–Ω–æ–≤–ª—è—é—Ç—Å—è —á–µ—Ä–µ–∑ ETag‚Äë–ø—É–ª–ª–∏–Ω–≥ –∫–∞–∂–¥—ã–µ ~60—Å —Å –¥–∂–∏—Ç—Ç–µ—Ä–æ–º, –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏ –∏ –ø—Ä–∏ –ø–µ—Ä–µ—Ö–æ–¥–µ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–∞–±–≤–∫–ª–∞–¥–∫–∏ (—Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –≤ `static/js/profile.js`).
    - –ó–∞–≥–æ–ª–æ–≤–æ–∫ —Å–≤–µ–∂–µ—Å—Ç–∏: —Å–µ—Ä–≤–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç `X-Updated-At` –≤ –æ—Ç–≤–µ—Ç—ã 200/304; –∫–ª–∏–µ–Ω—Ç (—á–µ—Ä–µ–∑ `etag-fetch.js`) –ø—Ä–∏ 304 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `headerUpdatedAt`, —á—Ç–æ–±—ã –æ–±–Ω–æ–≤–∏—Ç—å –ª–µ–π–±–ª ¬´–û–±–Ω–æ–≤–ª–µ–Ω–æ¬ª –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–ª–∞.

- –°—Ç—Ä–∞–Ω–∏—Ü–∞ –∫–æ–º–∞–Ω–¥—ã (–Ω–æ–≤–æ–µ)
        - API: `GET /api/team/overview?name=...` ‚Äî –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –ø–æ –∫–æ–º–∞–Ω–¥–µ –∑–∞ –≤—Å–µ —Å–µ–∑–æ–Ω—ã (W/D/L, GF/GA, clean sheets, last5), –∞ —Ç–∞–∫–∂–µ:
                - `recent` ‚Äî –¥–≤–∞ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –∑–∞–≤–µ—Ä—à—ë–Ω–Ω—ã—Ö –º–∞—Ç—á–∞: `{date, opponent, score, result}`
                - `tournaments` ‚Äî —á–∏—Å–ª–æ —É–Ω–∏–∫–∞–ª—å–Ω—ã—Ö —Ç—É—Ä–Ω–∏—Ä–æ–≤, –≤ –∫–æ—Ç–æ—Ä—ã—Ö –∫–æ–º–∞–Ω–¥–∞ —É—á–∞—Å—Ç–≤–æ–≤–∞–ª–∞
                - `cards` ‚Äî —Å—É–º–º–∞—Ä–Ω–æ `{ yellow, red }`
            –ö—ç—à: `etag_json` (`public, max-age=60, stale-while-revalidate=300`, `X-Updated-At`).
    - –ö–ª–∏–µ–Ω—Ç: `static/js/profile-team.js` ‚Äî `TeamPage.openTeam(name)` –∑–∞–≥—Ä—É–∂–∞–µ—Ç –¥–∞–Ω–Ω—ã–µ, –æ–±–Ω–æ–≤–ª—è–µ—Ç ¬´–û–±–Ω–æ–≤–ª–µ–Ω–æ¬ª –ø–æ `headerUpdatedAt` –¥–∞–∂–µ –ø—Ä–∏ 304.
    - –ù–∞–≤–∏–≥–∞—Ü–∏—è: —Ä–∞–∑–º–µ—Ç–∫–∞ –≤ `templates/index.html` ‚Äî –ø–∞–Ω–µ–ª—å `#ufo-team` —Å —Å–∞–±–≤–∫–ª–∞–¥–∫–∞–º–∏ ¬´–û–±–∑–æ—Ä/–ú–∞—Ç—á–∏/–°–æ—Å—Ç–∞–≤¬ª (–ø–æ—Å–ª–µ–¥–Ω–∏–µ –¥–≤–µ ‚Äî –∑–∞–≥–ª—É—à–∫–∏).
    - –¢–æ—á–∫–∏ –≤—Ö–æ–¥–∞: –∫–ª–∏–∫–∏ –ø–æ —ç–ª–µ–º–µ–Ω—Ç–∞–º —Å `data-team-name` (–Ω–∞–∑–≤–∞–Ω–∏–µ –∏ –ª–æ–≥–æ—Ç–∏–ø) –≤ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–∏/—Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞—Ö/—Ç–∞–±–ª–∏—Ü–µ –∏ ¬´–ü—Ä–æ–≥–Ω–æ–∑–∞—Ö¬ª. –ö–∞—Ä—Ç–æ—á–∫–∞ ¬´–ò–≥—Ä–∞ –Ω–µ–¥–µ–ª–∏¬ª –ø–æ –∫–ª–∏–∫—É –æ—Ç–∫—Ä—ã–≤–∞–µ—Ç –¥–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞ (–∞ –Ω–µ —ç–∫—Ä–∞–Ω –∫–æ–º–∞–Ω–¥—ã).
    - –í–æ–∑–≤—Ä–∞—Ç ¬´–ù–∞–∑–∞–¥¬ª –Ω–∞ —ç–∫—Ä–∞–Ω–µ –∫–æ–º–∞–Ω–¥—ã —É—á–∏—Ç—ã–≤–∞–µ—Ç –∫–æ–Ω—Ç–µ–∫—Å—Ç: –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç –≤ –¥–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞, –µ—Å–ª–∏ –ø–µ—Ä–µ—Ö–æ–¥ –±—ã–ª –∏–∑ –Ω–∏—Ö; –∏–Ω–∞—á–µ ‚Äî –≤ –∏—Å—Ö–æ–¥–Ω—É—é –ø–æ–¥–≤–∫–ª–∞–¥–∫—É –ª–∏–≥–∏.

- –ù–æ–≤–æ—Å—Ç–∏
    - –ü—É–±–ª–∏—á–Ω—ã–π API: `app.py` ‚Üí `GET /api/news`
    - –ê–¥–º–∏–Ω CRUD: `app.py` ‚Üí `/api/admin/news` (initData + ADMIN_USER_ID)
    - –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –ø—Ä–æ–≥—Ä–µ–≤: `optimizations/multilevel_cache.py` ‚Üí `invalidate_pattern`

- –°–µ–∑–æ–Ω–Ω—ã–π reset –∏ —Å–æ—Å—Ç–∞–≤—ã –∫–æ–º–∞–Ω–¥
    - Season rollover: `app.py` ‚Üí `POST /api/admin/season/rollover`
    - Season rollback: `api/admin.py` ‚Üí `POST /api/admin/season/rollback` (dry/force)
    - Persistent roster: `app.py` ‚Üí —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–æ–≤, —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è —Å `team_roster`
    - –ü—É–±–ª–∏—á–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã: `app.py` ‚Üí `GET /api/match/lineups?match_id=...`

- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ ETag
    - –£–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π –æ—Ç–≤–µ—Ç: `app.py` ‚Üí `_json_response`
    - –û–±—ë—Ä—Ç–∫–∞ —Å ETag: `app.py` ‚Üí `etag_json`
    - –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à: `optimizations/multilevel_cache.py`

–ü—Ä–æ–µ–∫—Ç –∏—Å–ø–æ–ª—å–∑—É–µ—Ç **–º–Ω–æ–≥–æ—Å–ª–æ–π–Ω—É—é –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä—É** —Å —ç–ª–µ–º–µ–Ω—Ç–∞–º–∏ **–º–æ–¥—É–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏**:
- **API Layer**: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –ø–æ –¥–æ–º–µ–Ω–∞–º (betting, admin, monitoring)
- **Business Logic Layer**: –û—Å–Ω–æ–≤–Ω–∞—è –ª–æ–≥–∏–∫–∞ –≤ `app.py` —Å —É—Ç–∏–ª–∏—Ç–∞–º–∏ –≤ `utils/`
- **Data Layer**: –û—Ç–¥–µ–ª—å–Ω—ã–π —Å–ª–æ–π –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (`database/`)
- **Optimization Layer**: –°–ø–µ—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Å–ª–æ–π –¥–ª—è –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏
- **Frontend**: –ú–æ–¥—É–ª—å–Ω–∞—è JavaScript –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Å —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ–º –ø–æ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏

## üõ† –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

| –ö–∞—Ç–µ–≥–æ—Ä–∏—è | –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—è | –í–µ—Ä—Å–∏—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ |
|-----------|------------|--------|------------|
| **Backend Framework** | Flask | 2.3.3 | –û—Å–Ω–æ–≤–Ω–æ–π –≤–µ–±-—Ñ—Ä–µ–π–º–≤–æ—Ä–∫ |
| **Database** | PostgreSQL | - | –û—Å–Ω–æ–≤–Ω–∞—è –ë–î (—á–µ—Ä–µ–∑ SQLAlchemy 2.0.36) |
| **ORM** | SQLAlchemy | 2.0.36 | –†–∞–±–æ—Ç–∞ —Å –±–∞–∑–æ–π –¥–∞–Ω–Ω—ã—Ö |
| **Cache** | Redis | 5.0.1 | –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤—ã–π –∫—ç—à (in-memory + Redis) |
| **WebSockets** | Flask-SocketIO | 5.3.6 | Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏—è |
| **External API** | Google Sheets API | gspread 6.0.0 | –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å —Ç–∞–±–ª–∏—Ü–∞–º–∏ |
| **Authentication** | Telegram WebApp | - | –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è —á–µ—Ä–µ–∑ Telegram |
| **Security** | Various | - | Rate limiting, CSRF, validation |
| **Deployment** | Gunicorn | 21.2.0 | Production WSGI —Å–µ—Ä–≤–µ—Ä (—á–µ—Ä–µ–∑ wsgi.py) |
| **Migrations** | Alembic | 1.13.2 | –ú–∏–≥—Ä–∞—Ü–∏–∏ (–ø–æ–¥–∫–ª—é—á–µ–Ω–æ, —Ç—Ä–µ–±—É–µ—Ç –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏) |
| **Sanitize** | Bleach | 6.1.0 | –û—á–∏—Å—Ç–∫–∞ HTML (–ø–ª–∞–Ω: –Ω–æ–≤–æ—Å—Ç–∏) |
| **Rate Limit** | flask-limiter | 3.5.0 | –õ–∏–º–∏—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ |
| **Monitoring** | psutil | 5.9.8 | –°–∏—Å—Ç–µ–º–Ω—ã–π –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ |
| **Frontend** | Vanilla JS | ES6+ | –ë–µ–∑ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤ |
| **Styling** | CSS3 | - | Custom CSS —Å —Ç–µ–º–∏–∑–∞—Ü–∏–µ–π |

### –Ø–∑—ã–∫–∏ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏—è
- **Python 3.12+** - Backend
- **JavaScript ES6+** - Frontend
- **CSS3** - –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
- **SQL** - –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
- **HTML5** - –†–∞–∑–º–µ—Ç–∫–∞

## üìä Google Sheets: –∞–¥–º–∏–Ω—Å–∫–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (–∏–º–ø–æ—Ä—Ç/—ç–∫—Å–ø–æ—Ä—Ç/—Ä–µ–º–æ–Ω—Ç)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: Google Sheets –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–π –¥–∞–Ω–Ω—ã—Ö (DB-only —á—Ç–µ–Ω–∏–µ –Ω–∞ –ø—É–±–ª–∏—á–Ω—ã—Ö –ø—É—Ç—è—Ö). –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è:

- POST `/api/admin/google/import-schedule` ‚Äî –∏–º–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –∏–∑ –ª–∏—Å—Ç–∞ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ –ë–î (snapshot schedule + –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–µ–π).
- POST `/api/admin/google/export-all` ‚Äî —ç–∫—Å–ø–æ—Ä—Ç –∞–∫—Ç—É–∞–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –≤ —Ç–∞–±–ª–∏—Ü—É: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–∏, —Å—Ç–∞–≤–∫–∏, —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞, –∞ —Ç–∞–∫–∂–µ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ –≤–∫–ª–∞–¥–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏:
    - –ü–æ –∫–∞–∂–¥–æ–π –∫–æ–º–∞–Ω–¥–µ —Å–æ–∑–¥–∞—ë—Ç—Å—è –ª–∏—Å—Ç `team_{–ù–∞–∑–≤–∞–Ω–∏–µ–ö–æ–º–∞–Ω–¥—ã}` c –∫–æ–ª–æ–Ω–∫–∞–º–∏: `player_id, first_name, last_name, matches, yellow, red, assists, goals, goal_plus_assist` –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ `goal_plus_assist desc, matches asc, goals desc`.
    - –°–æ–∑–¥–∞—ë—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω–∞—è –≤–∫–ª–∞–¥–∫–∞ `–ì–û–õ+–ü–ê–°` —Å –æ–±—ä–µ–¥–∏–Ω—ë–Ω–Ω—ã–º —Ä–µ–π—Ç–∏–Ω–≥–æ–º –∏–≥—Ä–æ–∫–æ–≤ –ø–æ –ª–∏–≥–µ –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–∏.
    - –ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö: –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã (PlayerStatistics/MatchEvent/TeamComposition) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –æ–Ω–∞. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ –≤–∫–ª—é—á—ë–Ω –æ–≤–µ—Ä–ª–µ–π –ø–æ –∞–≥—Ä–µ–≥–∏—Ä–æ–≤–∞–Ω–Ω–æ–π —Ç–∞–±–ª–∏—Ü–µ `TeamPlayerStats`: –¥–∞–∂–µ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–æ–π —Å—Ö–µ–º—ã –∏/–∏–ª–∏ –Ω–µ—Å–æ–≤–ø–∞–¥–µ–Ω–∏—è—Ö –∏–º—ë–Ω, —ç–∫—Å–ø–æ—Ä—Ç –∑–∞–ø–æ–ª–Ω—è–µ—Ç –ª–∏—Å—Ç—ã `team_*` –∏ –≥–ª–æ–±–∞–ª—å–Ω—É—é `–ì–û–õ+–ü–ê–°` –ø–æ –¥–∞–Ω–Ω—ã–º `TeamPlayerStats` (–∏–≥—Ä—ã/–≥–æ–ª—ã/–ø–∞—Å—ã/–∫–∞—Ä—Ç–æ—á–∫–∏, goal+assist) ‚Äî –∏—Å–∫–ª—é—á–∞–µ—Ç –Ω—É–ª–∏ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç—å –¥–ª—è –∫–æ–º–∞–Ω–¥ –≤—Ä–æ–¥–µ ¬´–û–±–Ω–∏–Ω—Å–∫¬ª, ¬´–î–æ–∂–¥—å¬ª. –ï—Å–ª–∏ –∏ `TeamPlayerStats` –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –±–µ–∑–æ–ø–∞—Å–Ω—ã–π fallback –Ω–∞ `team_roster` —Å —É–ª—É—á—à–µ–Ω–∏—è–º–∏: –¥–µ–¥—É–ø –∏–º—ë–Ω (case-insensitive), —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ full name –Ω–∞ `first_name`/`last_name`, –ø–æ–ø—ã—Ç–∫–∞ —Å–æ–ø–æ—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å `Player.id` –ø–æ —à–∞–±–ª–æ–Ω–∞–º ¬´–§–∞–º–∏–ª–∏—è –ò–º—è¬ª –∏ ¬´–ò–º—è –§–∞–º–∏–ª–∏—è¬ª (–∏ –æ—Å—Ç–æ—Ä–æ–∂–Ω—ã–π contains‚Äëfallback) –¥–ª—è –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è `player_id` –∏ –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ —Å–ø–ª–∏—Ç–∞.
- POST `/api/admin/google/repair-users-sheet` ‚Äî —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π ¬´—Ä–µ–º–æ–Ω—Ç¬ª –ª–∏—Å—Ç–æ–≤ (—É–¥–∞–ª–µ–Ω–∏–µ –¥—É–±–ª–µ–π) —Å –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–º `sheet`:
    - `users` ‚Äî –¥–µ–¥—É–ø –ø–æ `user_id` (–∫–æ–ª–æ–Ω–∫–∞ A), —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω—è—è –∑–∞–ø–∏—Å—å.
    - `bets` ‚Äî –¥–µ–¥—É–ø –ø–æ `id` (–∫–æ–ª–æ–Ω–∫–∞ A).
    - `achievements`, `referrals` ‚Äî –¥–µ–¥—É–ø –ø–æ `user_id`, –µ—Å–ª–∏ –µ—Å—Ç—å `updated_at`, —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è —Å–∞–º–∞—è —Å–≤–µ–∂–∞—è –∑–∞–ø–∏—Å—å.
    - –õ—é–±–æ–π –∏–Ω–æ–π –ª–∏—Å—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, `–¢–ê–ë–õ–ò–¶–ê`) ‚Äî —É–¥–∞–ª–µ–Ω–∏–µ –∏–¥–µ–Ω—Ç–∏—á–Ω—ã—Ö —Å—Ç—Ä–æ–∫ (–ø–æ–ª–Ω–æ–µ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ —è—á–µ–µ–∫).
    - –û—Ç–≤–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç —Å–≤–æ–¥–∫—É: `deduped_rows` –∏ –¥–æ 10 –ø—Ä–∏–º–µ—Ä–æ–≤ —É–¥–∞–ª—ë–Ω–Ω—ã—Ö –¥—É–±–ª–µ–π –≤ `removed_examples` –¥–ª—è –∞—É–¥–∏—Ç–∞.

UI –∞–¥–º–∏–Ω‚Äë–ø–∞–Ω–µ–ª–∏ (`templates/admin_dashboard.html` + `static/js/admin-enhanced.js`):
- –í–æ –≤–∫–ª–∞–¥–∫–µ ¬´–°–µ—Ä–≤–∏—Å¬ª —Ä—è–¥–æ–º —Å –∫–Ω–æ–ø–∫–∞–º–∏ –∏–º–ø–æ—Ä—Ç–∞/—ç–∫—Å–ø–æ—Ä—Ç–∞ –¥–æ–±–∞–≤–ª–µ–Ω –≤—ã–ø–∞–¥–∞—é—â–∏–π —Å–ø–∏—Å–æ–∫ –≤—ã–±–æ—Ä–∞ –ª–∏—Å—Ç–∞ (`#repair-sheet-select`) –∏ –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ—á–∏—Å—Ç–∏—Ç—å –¥—É–±–ª–∏¬ª.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è: `users`, `achievements`, `referrals`, `bets`, `–¢–ê–ë–õ–ò–¶–ê`.
- –ü—Ä–∏ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–∏ –æ–ø–µ—Ä–∞—Ü–∏–π –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Telegram initData –∏ –ø—Ä–æ–≤–µ—Ä–∫–∞ `ADMIN_USER_ID` –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ.

–ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è Sheets:
- `GOOGLE_CREDENTIALS_B64` –∏–ª–∏ `GOOGLE_SHEETS_CREDENTIALS` (raw JSON) ‚Äî —É—á—ë—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ —Å–µ—Ä–≤–∏—Å‚Äë–∞–∫–∫–∞—É–Ω—Ç–∞.
- `SHEET_ID` –∏–ª–∏ `SPREADSHEET_ID` ‚Äî ID —Ç–∞–±–ª–∏—Ü—ã.
- –≠–∫—Å–ø–æ—Ä—Ç –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—ë—Ç –Ω–µ–¥–æ—Å—Ç–∞—é—â–∏–µ –ª–∏—Å—Ç—ã (ensure_worksheet) –∏ –æ—á–∏—â–∞–µ—Ç –ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∑–∞–ø–∏—Å—å—é (clear_worksheet) –¥–ª—è –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö.
  
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ:
- Admin-only endpoint `POST /api/admin/leaderboards/refresh` –≤—ã–ø–æ–ª–Ω—è–µ—Ç –ø—Ä–∏–Ω—É–¥–∏—Ç–µ–ª—å–Ω—ã–π refresh/–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—é –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç in-memory ETag ‚Äî –ø–æ–ª–µ–∑–Ω–æ –ø—Ä–∏ `ENABLE_SCHEDULER=0` –∏ `LEADER_PRECOMPUTE_ENABLED=0`.

### –ñ–∏–≤–∞—è —Ç—É—Ä–Ω–∏—Ä–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ (live)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: –ø–æ–∫–∞–∑—ã–≤–∞—Ç—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è–º ¬´–ø—Ä–æ–µ–∫—Ü–∏—é¬ª —Ç—É—Ä–Ω–∏—Ä–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã –≤ –ø—Ä–æ—Ü–µ—Å—Å–µ –∏–¥—É—â–∏—Ö –º–∞—Ç—á–µ–π –±–µ–∑ –æ–∂–∏–¥–∞–Ω–∏—è —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ –∑–∞—Å–µ—Ç–∞.

- Endpoint: `GET /api/league-table/live`
- –ö–æ–Ω—Ç—Ä–∞–∫—Ç –æ—Ç–≤–µ—Ç–∞: –∫–∞–∫ —É –æ–±—ã—á–Ω–æ–π —Ç–∞–±–ª–∏—Ü—ã, –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ `live: true` –∏ `updated_at`.
- –ê–ª–≥–æ—Ä–∏—Ç–º: —Å—Ç—Ä–æ–∏—Ç—Å—è –±–∞–∑–æ–≤–∞—è –∞–≥—Ä–µ–≥–∞—Ü–∏—è (finished/settled —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã, —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∏–∑ snapshot `schedule`), –∑–∞—Ç–µ–º –Ω–∞–∫–ª–∞–¥—ã–≤–∞—é—Ç—Å—è —Ç–µ–∫—É—â–∏–µ —Å—á—ë—Ç–∞ –∏–∑ `MatchScore` –¥–ª—è –º–∞—Ç—á–µ–π –≤ —Å—Ç–∞—Ç—É—Å–∞—Ö in‚Äëprogress/ongoing.
- –ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ: `Cache-Control: no-store` (–≤—Å–µ–≥–¥–∞ —Å–≤–µ–∂–∏–µ –¥–∞–Ω–Ω—ã–µ); –æ–±—ã—á–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞ –æ—Å—Ç–∞—ë—Ç—Å—è –ø–æ–¥ `etag_json` –∏ –∫—ç—à–µ–º.
- –ö–ª–∏–µ–Ω—Ç: `static/js/league.js` —Å–Ω–∞—á–∞–ª–∞ –ø—ã—Ç–∞–µ—Ç—Å—è `fetch('/api/league-table/live', {cache:'no-store'})`, –ø—Ä–∏ –æ—à–∏–±–∫–µ –¥–µ–ª–∞–µ—Ç fallback –Ω–∞ `/api/league-table`. WebSocket‚Äë–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è (`data_patch`/`data_changed`) —Ç—Ä–∏–≥–≥–µ—Ä–∏—Ç –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫—É live‚Äë—Ç–∞–±–ª–∏—Ü—ã.

## üèó –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã –∏ –Ω–æ–≤—ã–µ –ø–æ–¥—Å–∏—Å—Ç–µ–º—ã

–ù–æ–≤—ã–µ —ç–ª–µ–º–µ–Ω—Ç—ã (Q3 2025):
1. –°–µ–∑–æ–Ω–Ω—ã–π ¬´deep reset¬ª (dry / soft / full / deep): —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∏ –ø–µ—Ä–µ—Å–±–æ—Ä –¥–∞–Ω–Ω—ã—Ö.
2. –û—á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ B,D —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è –≤ Google Sheets –ø—Ä–∏ deep reset (—Å—Ç—Ä–æ–∫–∏ 2..300).
3. CRUD –Ω–æ–≤–æ—Å—Ç–µ–π + –ø—É–±–ª–∏—á–Ω—ã–π `/api/news` (–∫—ç—à + ETag MD5) + –ø—Ä–æ–≥—Ä–µ–≤.
4. –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞ –ø–æ—Å–ª–µ –æ–ø–µ—Ä–∞—Ü–∏–π (–Ω–æ–≤–æ—Å—Ç–∏, —Å–µ–∑–æ–Ω–Ω—ã–π —Å–±—Ä–æ—Å).
5. –ü–æ–º–æ—â–Ω–∏–∫ `_get_news_session()` –¥–ª—è –ø–ª–∞–≤–Ω–æ–π –º–∏–≥—Ä–∞—Ü–∏–∏ –∫ `DatabaseManager`.
6. Snapshot —Å—Ç—Ä–∞—Ç–µ–≥–∏—è `/api/stats-table` (ETag + fallback –≥–µ–Ω–µ—Ä–∞—Ü–∏—è –∏–∑ –∏–≥—Ä–æ–∫–æ–≤ / —Å–æ–±—ã—Ç–∏–π).
7. `invalidate_pattern` –¥–ª—è –º–∞—Å—Å–æ–≤–æ–≥–æ —Å–±—Ä–æ—Å–∞ (e.g. `cache:news`).
8. ETag —Ç–∞–∫–∂–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤.
9. Persistent roster (`team_roster`): —Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ—Å–ª–µ–¥–Ω–∏—Ö –ø–æ–¥—Ç–≤–µ—Ä–∂–¥—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ –∫–æ–º–∞–Ω–¥—ã —Å –¥–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏–µ–π (case-insensitive) –∏ –∞–≤—Ç–æ—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–µ–π –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ç—á–µ–≤–æ–≥–æ —Å–æ—Å—Ç–∞–≤–∞.

### 1. –ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ API

```python
# api/betting.py - –ü—Ä–∏–º–µ—Ä –º–æ–¥—É–ª—å–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏
def init_betting_routes(app, get_db, SessionLocal, User, Bet, 
                       parse_and_verify_telegram_init_data, 
                       _build_betting_tours_payload, ...):
    """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –º–∞—Ä—à—Ä—É—Ç–æ–≤ —Å—Ç–∞–≤–æ–∫ —Å –≤–Ω–µ–¥—Ä–µ–Ω–∏–µ–º –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π"""
    
    @betting_bp.route('/place', methods=['POST'])
    def api_betting_place():
        """–†–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏"""
        try:
            parsed = parse_and_verify_telegram_init_data(request.form.get('initData', ''))
            if not parsed or not parsed.get('user'):
                return jsonify({'error': '–ù–µ–¥–µ–π—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ'}), 401
            
            # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
            return jsonify({'status': 'success'})
        except Exception as e:
            app.logger.error(f"Betting place error: {e}")
            return jsonify({'error': '–ù–µ —É–¥–∞–ª–æ—Å—å —Ä–∞–∑–º–µ—Å—Ç–∏—Ç—å —Å—Ç–∞–≤–∫—É'}), 500
```

### 2. –°–∏—Å—Ç–µ–º–∞ –¥–µ–∫–æ—Ä–∞—Ç–æ—Ä–æ–≤ –¥–ª—è –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# utils/decorators.py
@app.route('/api/betting/place', methods=['POST'])
@require_telegram_auth()
@rate_limit(max_requests=5, time_window=60)
@validate_input(
    initData={'type':'string','required':True,'min_length':1},
    market={'type':'string','required':True,'min_length':1},
    stake='int'
)
def api_betting_place():
    # –û–±—Ä–∞–±–æ—Ç—á–∏–∫ —É–∂–µ –ø–æ–ª—É—á–∞–µ—Ç –≤–∞–ª–∏–¥–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ
    pass
```

### 3. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ (—Ä–∞—Å—à–∏—Ä–µ–Ω–æ)

–ê–ª–≥–æ—Ä–∏—Ç–º now:
1. Memory (TTL per type) ‚Üí —Å–≤–µ–∂–æ? –≤–µ—Ä–Ω—É—Ç—å.
2. Redis (pickle) ‚Üí hydrate memory.
3. Loader (–µ—Å–ª–∏ –∑–∞–¥–∞–Ω) ‚Üí —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ –æ–±–∞ —É—Ä–æ–≤–Ω—è.
4. –ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Ç–æ—á–µ—á–Ω–∞—è (`invalidate`) –∏ –ø–æ —à–∞–±–ª–æ–Ω—É (`invalidate_pattern`).

TTL –ø—Ä–∏–º–µ—Ä—ã: league_table 300s/1800s, news 120s/300s.

–ü—É–±–ª–∏–∫–∞—Ü–∏—è –Ω–æ–≤–æ—Å—Ç–µ–π –≤—ã–∑—ã–≤–∞–µ—Ç: –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è `cache:news` + –ø—Ä–æ–≥—Ä–µ–≤ `limit:5:offset:0`.

–ü—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–æ–≤ (precompute):
- –û—Ç–¥–µ–ª—å–Ω—ã–π —Ñ–æ–Ω–æ–≤—ã–π –ø–æ—Ç–æ–∫ —Å –∏–Ω—Ç–µ—Ä–≤–∞–ª–æ–º `LEADER_PRECOMPUTE_SEC` (60—Å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) —Å—Ç—Ä–æ–∏—Ç JSON‚Äëpayload'—ã –¥–ª—è: `top-predictors`, `top-rich`, `server-leaders`, `prizes` –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –∏—Ö –≤ Redis (—Ç–∏–ø –∫—ç—à–∞ `leaderboards`).
- –≠–Ω–¥–ø–æ–∏–Ω—Ç—ã `/api/leaderboard/*` —Ç–µ–ø–µ—Ä—å —Å–Ω–∞—á–∞–ª–∞ —á–∏—Ç–∞—é—Ç –ø—Ä–µ–¥–≤—ã—á–∏—Å–ª–µ–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ –∏–∑ Redis (–±—ã—Å—Ç—Ä—ã–π –ø—É—Ç—å), –∏ —Ç–æ–ª—å–∫–æ –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç DB snapshot/–≤–Ω—É—Ç—Ä–µ–Ω–Ω–∏–µ –∫—ç—à–∏.
- Env‚Äë—Ñ–ª–∞–≥–∏:
    - `LEADER_PRECOMPUTE_ENABLED=1` ‚Äî –≤–∫–ª—é—á–∏—Ç—å —Ñ–æ–Ω–æ–≤—ã–π –ø—Ä–æ–≥—Ä–µ–≤
    - `LEADER_PRECOMPUTE_SEC=60` ‚Äî –ø–µ—Ä–∏–æ–¥ –ø—Ä–æ–≥—Ä–µ–≤–∞ –≤ —Å–µ–∫—É–Ω–¥–∞—Ö

### 3a. ETag –ø–æ–≤–µ—Ä—Ö –∫—ç—à–∞
–ü—É–±–ª–∏—á–Ω—ã–µ –æ—Ç–≤–µ—Ç—ã —Å–µ—Ä–∏–∞–ª–∏–∑—É—é—Ç—Å—è (sorted keys, UTF-8) ‚Üí MD5 ‚Üí `ETag`. –ö–ª–∏–µ–Ω—Ç –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏ –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `If-None-Match`, —Å–µ—Ä–≤–µ—Ä –æ—Ç–¥–∞—ë—Ç 304.

### 4. –ü–∞—Ç—Ç–µ—Ä–Ω Repository –¥–ª—è —Ä–∞–±–æ—Ç—ã —Å –¥–∞–Ω–Ω—ã–º–∏ (–∞–∫—Ç—É–∞–ª–µ–Ω)

```python
# database/database_models.py
class Tournament(Base):
    __tablename__ = 'tournaments'
    
    id = Column(Integer, primary_key=True)
    name = Column(String(255), nullable=False)
    season = Column(String(100), nullable=False)
    status = Column(String(50), default='active')
    
    # Relationships
    matches = relationship("Match", back_populates="tournament")
```

### 4a. Real-time –ø–∞—Ç—á–∏ –∏ –≤–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ: —É–º–µ–Ω—å—à–∏—Ç—å —Ç—Ä–∞—Ñ–∏–∫ –∏ –∑–∞–¥–µ—Ä–∂–∫–∏ –ø—Ä–∏ live‚Äë–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è—Ö —á–µ—Ä–µ–∑ –∫–æ–º–ø–∞–∫—Ç–Ω—ã–µ WebSocket‚Äë–ø–∞—Ç—á–∏, —Å–æ—Ö—Ä–∞–Ω—è—è —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤.

–ö–∞–Ω–∞–ª –∏ —Ñ–æ—Ä–º–∞—Ç —Å–æ–±—ã—Ç–∏—è
- –°–æ–±—ã—Ç–∏–µ: `data_patch`
- –§–æ—Ä–º–∞—Ç:
    - `{ type: 'data_patch', entity: 'match'|'odds', id: { home, away, date }, fields: { ... } }`
    - –ò–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä –º–∞—Ç—á–∞: `id = { home: string, away: string, date: string }`

–ß—Ç–æ —à–ª—ë—Ç —Å–µ—Ä–≤–µ—Ä —Å–µ–π—á–∞—Å
- entity `match`: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—á—ë—Ç–∞ –∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã—Ö —Ä—ã–Ω–∫–æ–≤ (penalty/redcard)
    - `fields`: `score_home`, `score_away`, `penalty_yes`, `redcard_yes` (–ø–æ —Å–∏—Ç—É–∞—Ü–∏–∏)
    - –í—Å–µ–≥–¥–∞ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è `odds_version` (–∏–Ω–∫—Ä–µ–º–µ–Ω—Ç–∏—Ä—É–µ—Ç—Å—è –ø—Ä–∏ –≤–ª–∏—è—é—â–∏—Ö –∏–∑–º–µ–Ω–µ–Ω–∏—è—Ö)
- entity `odds`: –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –ø–æ—Å–ª–µ —Å—Ç–∞–≤–∫–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
    - `fields`: `home`, `draw`, `away` (–Ω–æ–≤—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤)
    - –û—Ç–ø—Ä–∞–≤–ª—è–µ—Ç—Å—è —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (debounce) –¥–ª—è –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∏ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö —Å—Ç–∞–≤–æ–∫ –≤ –æ–¥–Ω–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ.
- –í payload —Ç—É—Ä–æ–≤ (`/api/betting/tours`) –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –º–∞—Ç—á–∞ –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç `odds_version` (–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –≤–µ—Ä—Å–∏–∏ –Ω–∞ –∫–ª–∏–µ–Ω—Ç–µ)

–°–Ω–∞–ø—à–æ—Ç `results`:
- –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤ `POST /api/match/settle` –ø—Ä–∏ –Ω–∞–ª–∏—á–∏–∏ —Ñ–∏–Ω–∞–ª—å–Ω–æ–≥–æ —Å—á—ë—Ç–∞ –≤ `MatchScore` (upsert –∑–∞–ø–∏—Å–∏ –≤ –º–∞—Å—Å–∏–≤–µ `results`, –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ `updated_at`). –°—Ç–∞—Ä—ã–µ –∑–∞–ø–∏—Å–∏ –ø–æ —Ç–æ–º—É –∂–µ –º–∞—Ç—á—É –ø–µ—Ä–µ–∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è; –æ—Ç–¥–µ–ª—å–Ω–∞—è –∏—Å—Ç–æ—Ä–∏—è –≤–µ—Ä—Å–∏–π –Ω–µ –≤–µ–¥—ë—Ç—Å—è.

–ö–∞–∫ –≤–µ–¥—ë—Ç —Å–µ–±—è –∫–ª–∏–µ–Ω—Ç (static/js/realtime-updates.js, static/js/predictions.js)
- –ü–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ WebSocket-—Ç–æ–ø–∏–∫–∏ `predictions_page` –∏ `match_odds_{match_id}`.
- –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç –ª–æ–∫–∞–ª—å–Ω—É—é –∫–∞—Ä—Ç—É –≤–µ—Ä—Å–∏–π –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ per‚Äëmatch (–≤ –ø–∞–º—è—Ç–∏)
- –ï—Å–ª–∏ –≤–æ –≤—Ö–æ–¥—è—â–µ–º –ø–∞—Ç—á–µ `fields.odds_version` –º–µ–Ω—å—à–µ —É–∂–µ –∏–∑–≤–µ—Å—Ç–Ω–æ–π –≤–µ—Ä—Å–∏–∏ ‚Äî –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ä—ã–Ω–∫–æ–≤/–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ –∏–≥–Ω–æ—Ä–∏—Ä—É—é—Ç—Å—è (–∑–∞—â–∏—Ç–∞ –æ—Ç —Ä–µ–≥—Ä–µ—Å—Å–∏–∏)
- –ü–æ–ª—è —Å–æ—Å—Ç–æ—è–Ω–∏—è –º–∞—Ç—á–∞ (—Å—á—ë—Ç, specials) –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è –≤—Å–µ–≥–¥–∞ –¥–ª—è `entity: 'match'`
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ `entity: 'odds'` –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö —Å—Ç–∞–≤–æ–∫ (–ü1/–•/–ü2) –±–µ–∑ –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∫–∏ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

–ú–∏–Ω–∏‚Äë–∫–æ–Ω—Ç—Ä–∞–∫—Ç –ø–æ–ª–µ–π
- `entity: 'match'`: `fields` –º–æ–≥—É—Ç —Å–æ–¥–µ—Ä–∂–∞—Ç—å `score_home`, `score_away`, `penalty_yes`, `redcard_yes`, –≤—Å–µ–≥–¥–∞ –¥–æ–ø—É—Å—Ç–∏–º `odds_version`
- `entity: 'odds'`: `fields` —Å–æ–¥–µ—Ä–∂–∞—Ç `home`, `draw`, `away` –∏ –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ `odds_version`

–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å –∏ –±—É–¥—É—â–µ–µ —Ä–∞–∑–≤–∏—Ç–∏–µ
- –í–µ—Ä—Å–∏–∏ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞—é—Ç—Å—è –≤ –ø–∞–º—è—Ç–∏ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (`_ODDS_VERSION`, `_get_odds_version`, `_bump_odds_version` –≤ `app.py`)
- –ú–µ—Ç–æ–¥ –æ—Ç–ø—Ä–∞–≤–∫–∏ –ø–∞—Ç—á–µ–π: `optimizations/websocket_manager.py: notify_patch_debounced` –∏ `emit_to_topic_batched`.
- –ü–∞–∫–µ—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ —á–∞—Å—Ç—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ —á–µ—Ä–µ–∑ `emit_to_topic_batched` —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π ~3.5—Å.

#### Fallback –±–µ–∑ WebSockets (free tier Render)
 –ü—Ä–æ–≥–Ω–æ–∑—ã/—Å—Ç–∞–≤–∫–∏ (–∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã): –º–æ–¥—É–ª—å `static/js/predictions.js` –ø—Ä–∏ –æ—Ç–∫–ª—é—á—ë–Ω–Ω—ã—Ö WS –≤—ã–ø–æ–ª–Ω—è–µ—Ç ETag‚Äë–æ–ø—Ä–æ—Å `/api/betting/tours` –∫–∞–∂–¥—ã–µ ~3.5‚Äì4.7 —Å–µ–∫—É–Ω–¥—ã –∏ –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ –ø–æ–¥–ø–∏—Å–∏ –∫–Ω–æ–ø–æ–∫ –ü1/–•/–ü2 —É –≤–∏–¥–∏–º—ã—Ö –∫–∞—Ä—Ç–æ—á–µ–∫ –º–∞—Ç—á–µ–π (–±–µ–∑ –ø–æ–ª–Ω–æ–≥–æ —Ä–µ–Ω–¥–µ—Ä–∞). –ü—É–ª–ª–∏–Ω–≥ –æ—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–∏ –Ω–∞ –ø–æ–¥‚Äë–≤–∫–ª–∞–¥–∫—É ¬´–ú–æ–∏ —Å—Ç–∞–≤–∫–∏¬ª, –ø—Ä–∏ —Å–∫—Ä—ã—Ç–∏–∏ –≤–∫–ª–∞–¥–∫–∏, –∞ —Ç–∞–∫–∂–µ –ø—Ä–∏ —É—Ö–æ–¥–µ —Å–æ —Å—Ç—Ä–∞–Ω–∏—Ü—ã.

```javascript
 –ü—Ä–æ–≥–Ω–æ–∑—ã/—Å—Ç–∞–≤–∫–∏ (–∫–ª–∏–µ–Ω—Ç): –¥–æ–±–∞–≤–ª–µ–Ω fallback ETag‚Äë–ø—É–ª–ª–∏–Ω–≥ –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç–æ–≤ (3‚Äì5—Å) –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω—ã—Ö WebSocket. –û–±–Ω–æ–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫–Ω–æ–ø–∫–∏ –ü1/–•/–ü2 –Ω–∞ –∫–∞—Ä—Ç–æ—á–∫–∞—Ö. –í–µ—Ä—Å–∏–æ–Ω–Ω–æ—Å—Ç—å odds_version —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è.
 –î–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞ (–∞–¥–º–∏–Ω): —É—Å—Ç—Ä–∞–Ω—ë–Ω –≤–∏–∑—É–∞–ª—å–Ω—ã–π ¬´—Ñ–ª–∏–∫–µ—Ä¬ª –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π (–∂—ë–ª—Ç–∞—è/–∫—Ä–∞—Å–Ω–∞—è/–≥–æ–ª/–∞—Å—Å–∏—Å—Ç) ‚Äî –ø–æ—Å–ª–µ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –∞–¥–º–∏–Ω—Å–∫–æ–≥–æ –∏–∑–º–µ–Ω–µ–Ω–∏—è –ø–æ–¥–∞–≤–ª—è–µ—Ç—Å—è –∞–≤—Ç–æ‚Äë–ø–µ—Ä–µ—Ä–∏—Å–æ–≤–∫–∞ —Å–æ—Å—Ç–∞–≤–æ–≤ –≤ —Ç–µ—á–µ–Ω–∏–µ ~8 —Å–µ–∫—É–Ω–¥, —á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å —Å–∫–∞—á–∫–æ–≤ UI –ø—Ä–∏ –ø—Ä–∏—Ö–æ–¥–µ —Ñ–æ–Ω–æ–≤–æ–≥–æ –æ–ø—Ä–æ—Å–∞.
// static/js/profile.js - –û—Å–Ω–æ–≤–Ω–æ–π –º–æ–¥—É–ª—å
(() => {
    // –ì–ª–æ–±–∞–ª—å–Ω—ã–π rate limiter –¥–ª—è fetch –∑–∞–ø—Ä–æ—Å–æ–≤
    const originalFetch = window.fetch.bind(window);
    const cfg = Object.assign({ tokensPerSec: 20, bucketCapacity: 20 }, 
                              window.__FETCH_LIMITS__ || {});
    
    // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è fetch —Å rate limiting
    window.fetch = (input, init) => new Promise((resolve, reject) => {
        queue.push({ run: () => originalFetch(input, init).then(resolve, reject) });
        schedule();
    });
})();

## üîÑ –ù–µ–¥–∞–≤–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è (—Å–µ–Ω—Ç—è–±—Ä—å 2025)

### 2025-09-07 (UX –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ)
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: ¬´–¶–µ–ª–∏¬ª (–ª–µ—Å—Ç–Ω–∏—Ü—ã all_targets) –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω—ã –≤–Ω—É—Ç—Ä—å –±–ª–æ–∫–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª –≤ `static/js/profile-achievements.js`; –≤ –∫—Ä–∞—Ç–∫–æ–π –∫–∞—Ä—Ç–æ—á–∫–µ –æ—Å—Ç–∞–ª—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–µ—Å—Å `value/next_target` –∏ –±–µ–π–¥–∂ —É—Ä–æ–≤–Ω—è –ø–æ `best_tier`.
- Splash: —Å–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞ —Ç–µ–ø–µ—Ä—å –æ—Ä–∫–µ—Å—Ç—Ä–∏—Ä—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω—ã–º–∏ —Å–æ–±—ã—Ç–∏—è–º–∏ –ø—Ä–µ–¥–∑–∞–≥—Ä—É–∑–∫–∏. `static/js/profile-ads-featured.js` –¥–∏—Å–ø–∞—Ç—á–∏—Ç `preload:ads-ready` –ø–æ—Å–ª–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏–∏ –∫–∞—Ä—É—Å–µ–ª–∏ –∏ `preload:topmatch-ready` –ø–æ—Å–ª–µ –ø–æ—Å—Ç—Ä–æ–µ–Ω–∏—è –∫–∞—Ä—Ç–æ—á–∫–∏ ¬´–º–∞—Ç—á–∞ –Ω–µ–¥–µ–ª–∏¬ª. `static/js/splash.js` —Å–ª—É—à–∞–µ—Ç `preload:news-ready`, `preload:ads-ready`, `preload:topmatch-ready` –∏ –∑–∞–≤–µ—Ä—à–∞–µ—Ç –ø–æ–∫–∞–∑, –∫–æ–≥–¥–∞ –≥–æ—Ç–æ–≤—ã –Ω–æ–≤–æ—Å—Ç–∏ –ò (—Ä–µ–∫–ª–∞–º–∞ –ò–õ–ò –º–∞—Ç—á –Ω–µ–¥–µ–ª–∏).
- –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: —Å–Ω–∏–∂–µ–Ω —à—É–º –æ—Ç –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏–π ¬´No match found¬ª –ø—Ä–∏ —Ä–∞—Å—á—ë—Ç–µ —Ç–æ—Ç–∞–ª–æ–≤ ‚Äî –≤ `_get_match_total_goals` —Å–æ–æ–±—â–µ–Ω–∏–µ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–æ –≤ INFO –∏ –ª–æ–≥–∏—Ä—É–µ—Ç—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –Ω–∞ –ø–∞—Ä—É –∫–æ–º–∞–Ω–¥ (dedup); –ø—Ä–µ–¥—É–ø—Ä–µ–∂–¥–µ–Ω–∏—è –ø–æ –Ω–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–º—É —Ñ–æ—Ä–º–∞—Ç—É —Å—á—ë—Ç–∞ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –∫–∞–∫ WARNING.

### 2025-09-04
- Splash —ç–∫—Ä–∞–Ω: –¥–æ–±–∞–≤–ª–µ–Ω —á–∏—Å–ª–æ–≤–æ–π –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä –ø—Ä–æ–≥—Ä–µ—Å—Å–∞ (0‚Äì100%) –ø–æ–¥ –ø–æ–ª–æ—Å–æ–π –∑–∞–≥—Ä—É–∑–∫–∏.
- –í–≤–µ–¥—ë–Ω stage API `window.splashStages` (profile ‚Üí 70%, data ‚Üí 90%, finish ‚Üí 100%) + `setSplashProgress` –¥–ª—è —Ä—É—á–Ω–æ–π –∫–æ—Ä—Ä–µ–∫—Ü–∏–∏.
- –£—Å—Ç—Ä–∞–Ω—ë–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª: —É–±—Ä–∞–Ω—ã full-bleed —Å—Ç–∏–ª–∏ —É `.subtabs`, –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã `profile-top-area`, –∏–Ω—Å–µ—Ç –¥–ª—è –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏.
- UI: —É–≤–µ–ª–∏—á–µ–Ω —Ä–∞–∑–º–µ—Ä —à—Ä–∏—Ñ—Ç–∞ –∑–∞–≥–æ–ª–æ–≤–∫–∞ ¬´–ù–æ–≤–æ—Å—Ç–∏¬ª, –¥–æ–±–∞–≤–ª–µ–Ω—ã –±–æ–∫–æ–≤—ã–µ –æ—Ç—Å—Ç—É–ø—ã –Ω–∏–∂–Ω–µ–º—É –º–µ–Ω—é.
- –ß–∞—Å—Ç–∏—á–Ω–∞—è —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è match-details: –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤ `league.js` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ `fetchMatchDetails` (—Å–æ—Ö—Ä–∞–Ω—ë–Ω fallback –¥–ª—è legacy –∑–æ–Ω).
- –ú–∏–≥—Ä–∞—Ü–∏—è `/api/schedule` –∏ `/api/results` –Ω–∞ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω—ã–π `fetchEtag` (–∫–ª–∏–µ–Ω—Ç). –°–µ—Ä–≤–µ—Ä–Ω—ã–π `etag_json` –¥–ª—è –Ω–∏—Ö ‚Äî –≤ –ø–ª–∞–Ω–µ.
- –î–æ–±–∞–≤–ª–µ–Ω –ø–∏–ª–æ—Ç–Ω—ã–π retry (OperationalError / SSL EOF) –¥–ª—è `/api/betting/my-bets`: dispose engine ‚Üí –ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ—Å—Å–∏–∏ (–æ—Å–Ω–æ–≤–∞ –¥–ª—è –±—É–¥—É—â–µ–≥–æ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ helper).

### 2025-09-06 (–∫—Ä–∞—Ç–∫–æ–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–µ)
- –ù–µ–±–æ–ª—å—à–∏–µ —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥-–ø—Ä–∞–≤–∫–∏ –∏ —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏—è —Ç–µ–∫—Å—Ç–∞:
    - `body.profile-mode` toggled –ø—Ä–∏ –≤—Ö–æ–¥–µ/–≤—ã—Ö–æ–¥–µ –∏–∑ –ø—Ä–æ—Ñ–∏–ª—è ‚Äî —É—Å—Ç—Ä–∞–Ω—è–µ—Ç –æ—Ç—Å—Ç—É–ø—ã –≤–æ–∫—Ä—É–≥ full-bleed —Ñ–æ–Ω–∞ —à–∞–ø–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è.
    - –ê–≤–∞—Ç–∞—Ä –≤ —Ü–µ–Ω—Ç—Ä–µ –ø—Ä–æ—Ñ–∏–ª—è —Å–¥–≤–∏–Ω—É—Ç –≤–Ω–∏–∑ —á–µ—Ä–µ–∑ –ø—Ä–∞–≤–∏–ª–æ `.profile-header.profile-centered .profile-avatar { margin-top: 24px }` —á—Ç–æ–±—ã —Ä–∞—Å–ø–æ–ª–∞–≥–∞—Ç—å—Å—è –ø–æ–¥ –¥–µ–∫–æ—Ä–∞—Ç–∏–≤–Ω—ã–º —ç–ª–µ–º–µ–Ω—Ç–æ–º.
    - –£—Å—Ç—Ä–∞–Ω—ë–Ω –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–π —Å–∫—Ä–æ–ª–ª: `.subtabs` –æ–≥—Ä–∞–Ω–∏—á–µ–Ω—ã –ø–æ —à–∏—Ä–∏–Ω–µ –≤–Ω—É—Ç—Ä–∏ –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä–∞ –∏ full-bleed —ç–ª–µ–º–µ–Ω—Ç—ã –ø–µ—Ä–µ—Å–º–æ—Ç—Ä–µ–Ω—ã.
    - –¢–µ–∫—Å—Ç –Ω–∏–∂–Ω–µ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ —É–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞–Ω ‚Äî –ø–æ–¥ –∏–∫–æ–Ω–∫–æ–π –≤—Å–µ–≥–¥–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è ¬´–õ–∏–≥–∞¬ª, –∏–∫–æ–Ω–∫–∞ –≤–∏–∑—É–∞–ª—å–Ω–æ –º–µ–Ω—è–µ—Ç—Å—è –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç –≤—ã–±—Ä–∞–Ω–Ω–æ–π –ª–∏–≥–∏.
    - –°–æ–≥–ª–∞—Å–æ–≤–∞–Ω—ã –ø–æ–¥–ø–∏—Å–∏ –ª–∏–≥–∏ –≤ drawer/shelf –∏ —à–∞–±–ª–æ–Ω–∞—Ö (`index.html`, `static/js/profile.js`).
- –ü–∏–ª–æ—Ç–Ω—ã–π DB retry –¥–ª—è `/api/betting/my-bets` –æ—Ç–º–µ—á–µ–Ω –∫–∞–∫ –≤–Ω–µ–¥—Ä–µ–Ω–Ω—ã–π; –∑–∞–¥–∞—á–∞ –ø–æ –≤—ã–Ω–µ—Å–µ–Ω–∏—é –≤ —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π helper –æ—Å—Ç–∞—ë—Ç—Å—è –≤ backlog.

### 2025-09-06 (–≤–µ—á–µ—Ä, –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è)
        - –°–µ—Ä–≤–µ—Ä–Ω—ã–π etag_json:
            - –ü—Ä–∏–º–µ–Ω—ë–Ω –∫ `/api/schedule` –∏ `/api/results` (–µ–¥–∏–Ω—ã–µ –∑–∞–≥–æ–ª–æ–≤–∫–∏, 304 –ø–æ–≤–µ–¥–µ–Ω–∏–µ, core_filter).
            - `/api/match-details` –ø–µ—Ä–µ–ø–∏—Å–∞–Ω –Ω–∞ etag_json —Å private Cache-Control, —Å–æ—Ö—Ä–∞–Ω—ë–Ω –ª–æ–∫–∞–ª—å–Ω—ã–π TTL-–∫—ç—à –∏ —Ñ–æ—Ä–º–∞ –æ—Ç–≤–µ—Ç–∞ (version=etag).
            - `/api/betting/tours` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ etag_json —Å `public, max-age=300, stale-while-revalidate=300`; core_filter –∏—Å–∫–ª—é—á–∞–µ—Ç —Å–ª—É–∂–µ–±–Ω—ã–µ –ø–æ–ª—è, —É—á–∏—Ç—ã–≤–∞–µ—Ç—Å—è —Ç–æ–ª—å–∫–æ `{tours}`.
- –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DB retry helper:
    - –î–æ–±–∞–≤–ª–µ–Ω `_db_retry_read(session, query_callable, attempts=2, backoff_base=0.1)`.
    - `POST /api/betting/my-bets` –ø–µ—Ä–µ–≤–µ–¥—ë–Ω –Ω–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ helper (–∏–¥–µ–Ω—Ç–∏—á–Ω–æ–µ –ø–æ–≤–µ–¥–µ–Ω–∏–µ, –º–µ–Ω—å—à–µ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏—è).
    - –†–∞—Å—à–∏—Ä–µ–Ω–æ –ø–æ–∫—Ä—ã—Ç–∏–µ retry –Ω–∞ —á—Ç–µ–Ω–∏—è –≤ leaderboards, achievements –∏ lineups (admin/public/extended) ‚Äî –±–µ–∑–æ–ø–∞—Å–Ω–æ, –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –æ—Ç–≤–µ—Ç–æ–≤.
    - –î–æ–±–∞–≤–ª–µ–Ω—ã –ª—ë–≥–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ –∏ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ: `_DB_RETRY_METRICS` (calls/success/failures/retries) –∏ label –¥–ª—è –∞—Ç—Ä–∏–±—É—Ü–∏–∏.
    - –£–±—Ä–∞–Ω–æ –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –≤ leaderboards: –≤–≤–µ–¥–µ–Ω—ã helpers `_lb_weekly_predictor_rows`, `_lb_all_users`, `_lb_monthly_baseline_rows` (–ø–æ–≤–µ–¥–µ–Ω–∏–µ –±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π).
    ‚úî –ó–∞—â–∏—Ç–∞ `/health/db-retry-metrics`: –¥–æ—Å—Ç—É–ø —Ç–æ–ª—å–∫–æ –¥–ª—è –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞ –∏–ª–∏ –ø–æ —Å–µ–∫—Ä–µ—Ç–Ω–æ–º—É –∫–ª—é—á—É

    - –ü–æ–¥–¥–µ—Ä–∂–∞–Ω—ã 2 —Å–ø–æ—Å–æ–±–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏:
        1) HTTP-–∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-METRICS-KEY` —Å–æ –∑–Ω–∞—á–µ–Ω–∏–µ–º `METRICS_SECRET` (env)
        2) –í–∞–ª–∏–¥–Ω—ã–π Telegram `initData` –∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–µ `user.id` —Å `ADMIN_USER_ID`
    - –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è: –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `ADMIN_USER_ID`, `METRICS_SECRET`

–ü—Ä–∏–º–µ—á–∞–Ω–∏—è –ø–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏—é (2025-09-07)
- –§—É–Ω–∫—Ü–∏—è `_get_match_total_goals`: ¬´No match found¬ª ‚Äî INFO (–æ–¥–Ω–æ–∫—Ä–∞—Ç–Ω–æ –Ω–∞ (home,away)), malformed score ‚Äî WARNING. –≠—Ç–æ —Å–æ–∫—Ä–∞—â–∞–µ—Ç —à—É–º –ª–æ–≥–æ–≤ –ø—Ä–∏ –æ–±—Ä–∞–±–æ—Ç–∫–µ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤ –±–µ–∑ –≤–ª–∏—è–Ω–∏—è –Ω–∞ –≤—ã—è–≤–ª–µ–Ω–∏–µ –∞–Ω–æ–º–∞–ª–∏–π.

### 2025-09-03
- –ê–≤—Ç–æ–∑–∞–≥—Ä—É–∑–∫–∞ –Ω–æ–≤–æ—Å—Ç–µ–π –ø—Ä–∏ —Å—Ç–∞—Ä—Ç–µ SPA: `profile.js` –≤—ã–∑—ã–≤–∞–µ—Ç `loadNews()` –Ω–∞ `DOMContentLoaded`.
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è: –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–ª–∏–Ω–Ω—ã–µ –æ–ø–∏—Å–∞–Ω–∏—è –∏ –∫–Ω–æ–ø–∫–∞ ¬´–ü–æ–¥—Ä–æ–±–Ω–µ–µ¬ª (`profile-achievements.js`), —É–±—Ä–∞–Ω—ã placeholder'—ã.
- –°—Ç–∏–ª–∏: `.achv-desc`, `.achv-desc-toggle`, —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –ø—Ä–æ–≥—Ä–µ—Å—Å-–±–∞—Ä–æ–≤ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.
- –£–ª—É—á—à–µ–Ω–æ debug-–ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–∏–Ω–≥–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏–π.

–≠—Ç–∏ –ø—Ä–∞–≤–∫–∏ –ø–æ–≤—ã—à–∞—é—Ç UX (–ø–µ—Ä–≤—ã–π –∑–∞–ø—É—Å–∫ –±—ã—Å—Ç—Ä–µ–µ –≤–æ—Å–ø—Ä–∏–Ω–∏–º–∞–µ—Ç—Å—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º), —É–º–µ–Ω—å—à–∞—é—Ç –≤–∏–∑—É–∞–ª—å–Ω—ã–π —à—É–º –∏ –≥–æ—Ç–æ–≤—è—Ç –ø–æ—á–≤—É –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–π –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏ –∑–∞–≥—Ä—É–∑–∫–∏ (–∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è splashStages –≤ —Ä–µ–∞–ª—å–Ω—ã–µ —Ç–æ—á–∫–∏ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö).
```

## ‚ö° –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ (2025-09-06)

- –í–≤–µ–¥—ë–Ω –±—ã—Å—Ç—Ä—ã–π JSON-—Ä–µ–Ω–¥–µ—Ä –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ (orjson) –≤ —É–Ω–∏–≤–µ—Ä—Å–∞–ª—å–Ω–æ–º helper `etag_json`, –∞ —Ç–∞–∫–∂–µ —Ç–æ—á–µ—á–Ω–æ –≤ `/api/news` –∏ `/api/stats-table`. –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –æ—Ç–≤–µ—Ç–æ–≤ –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã, fallback –Ω–∞ —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π json —Å–æ—Ö—Ä–∞–Ω—ë–Ω.
- –õ—ë–≥–∫–∏–µ –º–µ—Ç—Ä–∏–∫–∏ ETag per-endpoint: `etag_json` —Å–æ–±–∏—Ä–∞–µ—Ç `requests`, `etag_requests`, `memory_hits`, `builds`, `served_200`, `served_304`, `hit_ratio`. –≠–∫—Å–ø–æ—Ä—Ç: `/health/etag-metrics` (admin-only, `X-METRICS-KEY` –∏–ª–∏ Telegram initData), –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç —Ñ–∏–ª—å—Ç—Ä `?prefix=leader-`.
- –ü—Ä–∏–º–µ—Ä: –ø–æ–ª—É—á–∏—Ç—å —Ç–æ–ª—å–∫–æ –ª–∏–¥–µ—Ä—ã ‚Äî –∑–∞–ø—Ä–æ—Å `GET /health/etag-metrics?prefix=leader-` —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º `X-METRICS-KEY: $METRICS_SECRET` –≤–µ—Ä–Ω—ë—Ç `by_key` —Å –ø–æ–ª—è–º–∏ –∏ `hit_ratio` –ø–æ –∫–∞–∂–¥–æ–º—É –∫–ª—é—á—É (`leader-top-predictors`, `leader-top-rich`, ...).
- –ë–µ–∑–æ–ø–∞—Å–Ω—ã–π cap –≤ –ª–∏–¥–µ—Ä–±–æ—Ä–¥–∞—Ö: `LEADERBOARD_ITEMS_CAP` (env, –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é 100) ‚Äî –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫ `/api/leaderboard/top-predictors`, `/api/leaderboard/top-rich`, `/api/leaderboard/server-leaders` –Ω–∞ –≤—Å–µ—Ö –∏—Å—Ç–æ—á–Ω–∏–∫–∞—Ö (Redis snapshot / DB snapshot / in-memory cache / fresh build). –ö–æ–Ω—Ç—Ä–∞–∫—Ç—ã –Ω–µ –∏–∑–º–µ–Ω–µ–Ω—ã.
- –î–æ–±–∞–≤–ª–µ–Ω –∑–∞–≥–æ–ª–æ–≤–æ–∫ `Vary: Accept-Encoding` –≤ `after_request` –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è –ø—Ä–∏ –≤–∫–ª—é—á—ë–Ω–Ω–æ–π –∫–æ–º–ø—Ä–µ—Å—Å–∏–∏ (gzip/br).
- –í–∫–ª—é—á–µ–Ω–∞ —Ñ–æ–Ω–æ–≤–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–æ—Ç—É—Ö—à–∏—Ö –∑–∞–ø–∏—Å–µ–π in-memory –∫—ç—à–∞ (`MultiLevelCache.cleanup_expired()`) –∫–∞–∂–¥—ã–µ 5 –º–∏–Ω—É—Ç ‚Äî —Å–Ω–∏–∂–∞–µ—Ç —Ä–∏—Å–∫ —Ä–æ—Å—Ç–∞ –ø–∞–º—è—Ç–∏.
- –í `etag_json` –¥–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∞—è –∑–∞—á–∏—Å—Ç–∫–∞ —É—Å—Ç–∞—Ä–µ–≤—à–∏—Ö –∑–∞–ø–∏—Å–µ–π (sweep) ‚Äî –∫–æ–Ω—Ç—Ä–æ–ª–∏—Ä—É–µ–º—ã–π —Ä–∞–∑–º–µ—Ä –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ ETag-–∫—ç—à–∞.

### 2025-09-06 (PR-2 / PR-3 —Å—Ç–∞—Ç—É—Å)

- [x] PR-2: topic-based publish pipeline ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–∞ –ø—É–±–ª–∏–∫–∞—Ü–∏—è topic-—Å–æ–æ–±—â–µ–Ω–∏–π –∏–∑ `optimizations/smart_invalidator.py` –≤ –∫–∞–Ω–∞–ª Redis `app:topic` –∏ –ª–æ–∫–∞–ª—å–Ω–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –≤ `optimizations/websocket_manager.py`.
- [x] PR-2a: frontend flags –∏ autosubscribe ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω—ã env-—Ñ–ª–∞–≥–∏ `WEBSOCKETS_ENABLED` –∏ `WS_TOPIC_SUBSCRIPTIONS_ENABLED`, –∫–ª–∏–µ–Ω—Ç –¥–µ–ª–∞–µ—Ç pre-probe –ø–µ—Ä–µ–¥ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ–º Socket.IO –∏ –∞–≤—Ç–æ–ø–æ–¥–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ `match:{home}__{away}__{date}:details` –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ —ç–∫—Ä–∞–Ω–∞.
- [x] PR-3: server-side per-topic batching/debounce ‚Äî `optimizations/websocket_manager.py` –ø–æ–ª—É—á–∏–ª –±—É—Ñ–µ—Ä–∏–∑–∞—Ü–∏—é –ø–æ —Ç–æ–ø–∏–∫–∞–º, –∞–≥—Ä–µ–≥–∞—Ü–∏—é `data_patch` –ø–æ–ª–µ–π –∏ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω—ã–π bypass –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π (–≥–æ–ª/–∫—Ä–∞—Å–Ω–∞—è –∫–∞—Ä—Ç–æ—á–∫–∞). –ü–æ —É–º–æ–ª—á–∞–Ω–∏—é debounce ‚âà180ms; priority>0 –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç –Ω–µ–º–µ–¥–ª–µ–Ω–Ω–æ.

–ö–æ—Ä–æ—Ç–∫–∏–µ —Å—Å—ã–ª–∫–∏ –Ω–∞ –∫–æ–¥ (–ª–æ–∫–∞–ª—å–Ω–æ –≤ —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏):
- `optimizations/smart_invalidator.py` ‚Äî `publish_topic(topic,event,payload,priority=0)` –∏ –ø–æ–¥–ø–∏—Å—á–∏–∫ Redis —Ç–µ–ø–µ—Ä—å —Å–ª—É—à–∞–µ—Ç `app:topic`.
- `optimizations/websocket_manager.py` ‚Äî `emit_to_topic_batched(topic,event,data,priority,delay_ms)` –∏ –º–µ—Ç—Ä–∏–∫–∏ `ws_messages_sent/ws_messages_batched/ws_messages_bypass`.
- `static/js/profile-match-advanced.js`, `static/js/profile-match-stats.js` ‚Äî polling fallback (details 5s + ETag, stats 10-15s + ETag) –∏ lifecycle cancellation.

–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ: –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –±–µ–∑–æ–ø–∞—Å–Ω–∞ –¥–ª—è –±–µ—Å–ø–ª–∞—Ç–Ω–æ–≥–æ Render-—Å–ª–æ—è ‚Äî WebSocket –≤–∫–ª—é—á–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ —Ñ–ª–∞–≥–∏, –∞ –ø—Ä–∏ –≤—ã–∫–ª—é—á–µ–Ω–Ω–æ–º WS –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è ETag-–ø–æ–¥—Ö–æ–¥ —Å –æ–ø—Ä–æ—Å–æ–º.

–ü–ª–∞–Ω –≠—Ç–∞–ø 2 (–±–µ–∑–æ–ø–∞—Å–Ω—ã–µ —É–ª—É—á—à–µ–Ω–∏—è):
- –ü–æ–¥—Å—Ç—Ä–æ–∏—Ç—å TTL –≤ `optimizations/multilevel_cache.py` –¥–ª—è `schedule`/`results` —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ —Å–Ω–∏–∂–µ–Ω–∏–µ —Ö–æ–ª–æ–¥–Ω—ã—Ö –∑–∞–≥—Ä—É–∑–æ–∫ ‚Äî –≤—ã–ø–æ–ª–Ω–µ–Ω–æ.
- –ú—è–≥–∫–∏–π debounce (~250–º—Å) –Ω–∞ —Å—Ç–æ—Ä–æ–Ω–µ —Å–µ—Ä–≤–µ—Ä–∞ –ø–µ—Ä–µ–¥ —à–∏—Ä–æ–∫–æ–≤–µ—â–∞—Ç–µ–ª—å–Ω—ã–º–∏ WebSocket-–ø–∞—Ç—á–∞–º–∏ ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ (—Å –±–µ–∑–æ–ø–∞—Å–Ω—ã–º fallback –Ω–∞ –ø—Ä—è–º—É—é –æ—Ç–ø—Ä–∞–≤–∫—É).
- –ü—Ä–∏–≤–µ—Å—Ç–∏ –æ—Å—Ç–∞–≤—à–∏–µ—Å—è —Ç—è–∂—ë–ª—ã–µ `jsonify` –∫ –±—ã—Å—Ç—Ä–æ–º—É `_json_response` —Ç–æ—á–µ—á–Ω–æ (–±–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–æ–≤).

## üé® UI/UX –∏ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏—è

### –ü–æ–¥—Ö–æ–¥—ã –∫ —Å—Ç–∏–ª–∏–∑–∞—Ü–∏–∏

1. **CSS Custom Properties (CSS Variables)**
```css
:root {
    /* UFO League Theme (default) */
    --bg: #0f1720;
    --card: #111827;
    --accent1: linear-gradient(135deg, #ffb86b, #6c8cff);
    --primary: #6c8cff;
    --transition: all 0.3s ease;
}

/* BLB League Theme */
body.blb-theme {
    --bg: #0a1128;
    --accent1: linear-gradient(135deg, #7a5f26, #eebb11);
    --primary: #eebb11;
}
```

2. **–ú–æ–¥—É–ª—å–Ω–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Å—Ç–∏–ª–µ–π**
- `style.css` - –æ—Å–Ω–æ–≤–Ω—ã–µ —Å—Ç–∏–ª–∏ –∏ —Ç–µ–º—ã
- `splash.css` - —Å—Ç–∏–ª–∏ –∑–∞–≥—Ä—É–∑–æ—á–Ω–æ–≥–æ —ç–∫—Ä–∞–Ω–∞  
- `blb.css` - —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è BLB –ª–∏–≥–∏
- `database-ui.css` - —Å—Ç–∏–ª–∏ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞

3. **–ê–¥–∞–ø—Ç–∏–≤–Ω—ã–π –¥–∏–∑–∞–π–Ω**
```css
body {
    touch-action: manipulation; /* –æ—Ç–∫–ª—é—á–µ–Ω–∏–µ pinch-zoom */
    padding: 16px 0 64px; /* –±–µ–∑ –±–æ–∫–æ–≤—ã—Ö –ø–æ–ª–µ–π */
    min-height: 100vh;
}

@media (max-width: 768px) {
    /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–æ–±–∏–ª—å–Ω—ã—Ö —É—Å—Ç—Ä–æ–π—Å—Ç–≤ */
}
```

### –¢–µ–º–∏–∑–∞—Ü–∏—è
–ü—Ä–æ–µ–∫—Ç –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç **–¥–∏–Ω–∞–º–∏—á–µ—Å–∫—É—é —Å–º–µ–Ω—É —Ç–µ–º**:
- **UFO League** (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é) - –∫–æ—Å–º–∏—á–µ—Å–∫–∞—è —Ç–µ–º–∞ —Å –≥—Ä–∞–¥–∏–µ–Ω—Ç–∞–º–∏
- **BLB League** - –∑–æ–ª–æ—Ç–∏—Å—Ç–æ-—Å–∏–Ω—è—è –∫–æ—Ä–ø–æ—Ä–∞—Ç–∏–≤–Ω–∞—è —Ç–µ–º–∞

### –î–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å (a11y)
- –°–µ–º–∞–Ω—Ç–∏—á–µ—Å–∫–∞—è —Ä–∞–∑–º–µ—Ç–∫–∞ HTML5
- ARIA-–∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
- –ö–æ–Ω—Ç—Ä–∞—Å—Ç–Ω—ã–µ —Ü–≤–µ—Ç–∞ –¥–ª—è —Ç–µ–∫—Å—Ç–∞
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –∫–ª–∞–≤–∏–∞—Ç—É—Ä–Ω–æ–π –Ω–∞–≤–∏–≥–∞—Ü–∏–∏

## ‚úÖ –ö–∞—á–µ—Å—Ç–≤–æ –∫–æ–¥–∞

### –°–∏—Å—Ç–µ–º—ã –≤–∞–ª–∏–¥–∞—Ü–∏–∏ –∏ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

```python
# utils/security.py
class InputValidator:
    TEAM_NAME_PATTERN = re.compile(r'^[–∞-—è–ê-–Øa-zA-Z0-9\s\-_\.]{1,50}$')
    SCORE_PATTERN = re.compile(r'^\d{1,2}:\d{1,2}$')
    
    @classmethod
    def validate_team_name(cls, name: str) -> tuple[bool, str]:
        """–í–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞–∑–≤–∞–Ω–∏—è –∫–æ–º–∞–Ω–¥—ã"""
        if not name or not isinstance(name, str):
            return False, "Team name is required"
        # ... –¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–∞—è –≤–∞–ª–∏–¥–∞—Ü–∏—è
        return True, name
```

### –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫

```python
# utils/middleware.py
class ErrorHandlingMiddleware:
    def __init__(self, app):
        self.app = app
        self.app.register_error_handler(Exception, self.handle_exception)
    
    def handle_exception(self, e):
        """–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫"""
        # –õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ, –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥, –æ—Ç–ø—Ä–∞–≤–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π
        return jsonify({'error': 'Internal server error'}), 500
```

### Rate Limiting

```python
# utils/decorators.py
def rate_limit(max_requests: int = 100, time_window: int = 60):
    """–î–µ–∫–æ—Ä–∞—Ç–æ—Ä –¥–ª—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤"""
    def decorator(f):
        @wraps(f)
        def decorated_function(*args, **kwargs):
            # –ü—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–º–∏—Ç–æ–≤ —á–µ—Ä–µ–∑ Redis
            if not rate_limiter.is_allowed(request.remote_addr, max_requests, time_window):
                return jsonify({'error': 'Too many requests'}), 429
            return f(*args, **kwargs)
        return decorated_function
    return decorator
```

### –ö–∞—á–µ—Å—Ç–≤–æ JavaScript –∫–æ–¥–∞

- **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –ø–æ —Ñ–∞–π–ª–∞–º —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç–∏
- **Throttling –¥–ª—è UI —Å–æ–±—ã—Ç–∏–π** - –ø—Ä–µ–¥–æ—Ç–≤—Ä–∞—â–µ–Ω–∏–µ spam-–∫–ª–∏–∫–æ–≤
- **–¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º** —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω—ã–µ –æ–±—ä–µ–∫—Ç—ã
- **–ö—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö** –≤ localStorage —Å TTL

## üîß –ö–ª—é—á–µ–≤—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

### 1. –°–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫ (Betting System)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª–Ω–æ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±—É–∫–º–µ–∫–µ—Ä—Å–∫–∏—Ö —Å—Ç–∞–≤–æ–∫

```python
# –ü—Ä–∏–º–µ—Ä —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏
@app.route('/api/betting/place', methods=['POST'])
@require_telegram_auth()
@rate_limit(max_requests=5, time_window=60)
def api_betting_place():
    market = request.form.get('market', '1x2')  # 1x2, totals, penalty, redcard
    selection = request.form.get('selection', '')  # home, draw, away, over_X, under_X
    stake = int(request.form.get('stake', 0))
    
    # –í–∞–ª–∏–¥–∞—Ü–∏—è –ª–∏–º–∏—Ç–æ–≤
    if stake < BET_MIN_STAKE or stake > BET_MAX_STAKE:
        return jsonify({'error': f'–°—Ç–∞–≤–∫–∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –æ—Ç {BET_MIN_STAKE} –¥–æ {BET_MAX_STAKE}'}), 400
```

**API**:
- `POST /api/betting/place` - —Ä–∞–∑–º–µ—â–µ–Ω–∏–µ —Å—Ç–∞–≤–∫–∏
- `GET /api/betting/tours` - –ø–æ–ª—É—á–µ–Ω–∏–µ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –º–∞—Ç—á–µ–π
- `POST /api/betting/my-bets` - –∏—Å—Ç–æ—Ä–∏—è —Å—Ç–∞–≤–æ–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

### 2. –ê–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–∞–º–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ 2025-09-03, –∞–∫—Ç—É–∞–ª–∏–∑–∞—Ü–∏—è)

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –£–ø—Ä–æ—â–µ–Ω–Ω–æ–µ —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å–æ—Å—Ç–∞–≤–∞–º–∏ –∫–æ–º–∞–Ω–¥ —á–µ—Ä–µ–∑ –≤–µ–±-–∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å

```javascript
// static/js/admin-enhanced.js - –ú–∞—Å—Å–æ–≤–æ–µ –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–æ–≤ (—É–ø—Ä–æ—â—ë–Ω–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç)
function updateTeamLineup(team){
    const textarea = document.getElementById(`${team}-main-lineup-input`);
    const lines = textarea.value.split('\n').map(l=>l.trim()).filter(Boolean);
    if(!lines.length){ showToast('–í–≤–µ–¥–∏—Ç–µ —Å–ø–∏—Å–æ–∫ –∏–≥—Ä–æ–∫–æ–≤','error'); return; }
    // –í–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–µ–π
    const counts = lines.reduce((a,l)=>{const k=l.toLowerCase();a[k]=(a[k]||0)+1;return a;},{});
    const dups = Object.entries(counts).filter(([_,c])=>c>1).map(([k])=>k);
    if(dups.length){ textarea.classList.add('has-dup'); showToast('–î—É–±–ª–∏–∫–∞—Ç—ã: '+dups.join(', '),'error',6000); return; }
    textarea.classList.remove('has-dup');
    currentLineups[team].main = lines.map(name => ({ name })); // —Ç–æ–ª—å–∫–æ –∏–º—è
    textarea.value='';
    renderLineups();
}
```

**–ö–ª—é—á–µ–≤—ã–µ —É–ª—É—á—à–µ–Ω–∏—è (–∞–∫—Ç—É–∞–ª—å–Ω–æ)**:
- –£–±—Ä–∞–Ω –ª–æ–≥–æ—Ç–∏–ø –∏–∑ header –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ (–±–æ–ª—å—à–µ —Ä–∞–±–æ—á–µ–π –ø–ª–æ—â–∞–¥–∏)
- –ú–∞—Å—Å–æ–≤—ã–π –≤–≤–æ–¥ —Å–æ—Å—Ç–∞–≤–æ–≤ —á–µ—Ä–µ–∑ –æ–¥–∏–Ω–æ—á–Ω—ã–π textarea (bulk paste)
- –¢–æ–ª—å–∫–æ –æ—Å–Ω–æ–≤–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã –±–µ–∑ –∑–∞–ø–∞—Å–Ω—ã—Ö (—É–ø—Ä–æ—â—ë–Ω–Ω–∞—è –º–æ–¥–µ–ª—å)
- –ü–æ–ª–Ω–æ—Å—Ç—å—é —É–¥–∞–ª–µ–Ω–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –Ω—É–º–µ—Ä–∞—Ü–∏—è (—Ç–æ–ª—å–∫–æ –∏–º–µ–Ω–∞)
- Inline –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥—É–±–ª–µ–π (case-insensitive) + –≤–∏–∑—É–∞–ª—å–Ω–∞—è –ø–æ–¥—Å–≤–µ—Ç–∫–∞
- Toast‚Äë—É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤–º–µ—Å—Ç–æ alert (–Ω–µ–Ω–∞–≤—è–∑—á–∏–≤—ã–π UX)
- WebSocket —Å–æ–±—ã—Ç–∏–µ `lineups_updated` –ø–æ—Å–ª–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è (–º–æ–º–µ–Ω—Ç–∞–ª—å–Ω—ã–π push)
- –ü—É–±–ª–∏—á–Ω—ã–π –∫–ª–∏–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Ç–æ–ª—å–∫–æ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π –º–∞—Ç—á (—Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π fetch)
- Persistent roster: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –º–∞—Ç—á–µ–≤—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ –æ—Å–Ω–æ–≤–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä—É–µ—Ç—Å—è –≤ —Ç–∞–±–ª–∏—Ü—É `team_roster` (–¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö, —É–¥–∞–ª–µ–Ω–∏–µ –∏—Å–∫–ª—é—á—ë–Ω–Ω—ã—Ö)
- Fallback –ª–æ–≥–∏–∫–∞: –µ—Å–ª–∏ —É –º–∞—Ç—á–∞ –Ω–µ—Ç —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ ‚Äî –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –ø–æ—Å–ª–µ–¥–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω—ë–Ω–Ω—ã–µ –∏–∑ `team_roster`
- –ù–æ–≤–∞—è —Ç–æ—á–∫–∞ `GET /api/match/lineups?match_id=...` (DB-first) –¥–ª—è –ø—É–±–ª–∏—á–Ω–æ–≥–æ –∫–ª–∏–µ–Ω—Ç–∞
- –î–µ–¥—É–ø–ª–∏–∫–∞—Ü–∏—è: –∏–º–µ–Ω–∞ –Ω–æ—Ä–º–∞–ª–∏–∑—É—é—Ç—Å—è (trim + collapse spaces + lower) –¥–ª—è —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç–∏
- –í–∏–∑—É–∞–ª—å–Ω–æ–µ –≤—ã–¥–µ–ª–µ–Ω–∏–µ –ø—Ä–æ–±–ª–µ–º–Ω—ã—Ö —Å—Ç—Ä–æ–∫ (CSS –∫–ª–∞—Å—Å `has-dup` / `dup-player`)

**API / Realtime (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)**:
- `POST /api/admin/match/{id}/lineups/save` ‚Äî —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ (emit `lineups_updated` + —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è `team_roster`)
- `POST /api/admin/match/{id}/lineups` ‚Äî –ø–æ–ª—É—á–µ–Ω–∏–µ —Ç–µ–∫—É—â–∏—Ö –º–∞—Ç—á–µ–≤—ã—Ö —Å–æ—Å—Ç–∞–≤–æ–≤ (—Å fallback –∫ `team_roster`)
- `GET /api/match/lineups?match_id=...` ‚Äî –ø—É–±–ª–∏—á–Ω—ã–µ —Å–æ—Å—Ç–∞–≤—ã (match-specific –∏–ª–∏ fallback roster)
- `POST /api/admin/season/rollover` ‚Äî —Å–±—Ä–æ—Å/–ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Å–µ–∑–æ–Ω–∞ (dry/soft/full/deep)
- `POST /api/admin/season/rollback` ‚Äî –æ—Ç–∫–∞—Ç –∫ –ø—Ä–µ–¥—ã–¥—É—â–µ–º—É —Å–µ–∑–æ–Ω—É (dry/force), –ø–µ—Ä–µ–∫–ª—é—á–∞–µ—Ç active –Ω–∞ –ø—Ä–µ–¥—ã–¥—É—â–∏–π —Ç—É—Ä–Ω–∏—Ä –±–µ–∑ –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏—è legacy-–¥–∞–Ω–Ω—ã—Ö
- WebSocket: —Å–æ–±—ã—Ç–∏–µ `lineups_updated` ‚Üí –∫–ª–∏–µ–Ω—Ç –≤—ã–∑—ã–≤–∞–µ—Ç `GET /api/match/lineups` (DB-first, –±–µ–∑ –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ Sheets)
- –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è: –ø—Ä–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–∏ –∏–º–µ–Ω–∞ –ø—Ä–∏–≤–æ–¥—è—Ç—Å—è –∫ lower –¥–ª—è –∫–ª—é—á–µ–π, —Ö—Ä–∞–Ω–∏—Ç—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–π –≤–∞—Ä–∏–∞–Ω—Ç –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è.

### 3. –ú–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–∞—è —Å–∏—Å—Ç–µ–º–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –°–Ω–∏–∂–µ–Ω–∏–µ –Ω–∞–≥—Ä—É–∑–∫–∏ –Ω–∞ –ë–î –∏ Google Sheets API

```python
class MultiLevelCache:
    def get(self, cache_type: str, identifier: str = '', loader_func: Optional[Callable] = None):
        # –£—Ä–æ–≤–µ–Ω—å 1: Memory cache (—Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ –¥–∞–Ω–Ω—ã–µ)
        if cache_type in ['league_table', 'schedule']:
            memory_data = self._get_from_memory(cache_type, identifier)
            if memory_data and not self._is_expired(memory_data):
                return memory_data['value']
        
        # –£—Ä–æ–≤–µ–Ω—å 2: Redis cache (—Å—Ä–µ–¥–Ω–∏–µ –¥–∞–Ω–Ω—ã–µ)
        if self.redis_client:
            redis_data = self._get_from_redis(cache_type, identifier)
            if redis_data:
                return redis_data
        
        # –£—Ä–æ–≤–µ–Ω—å 3: Database/Sheets (–∑–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö)
        if loader_func:
            fresh_data = loader_func()
            self._set_cache(cache_type, identifier, fresh_data)
            return fresh_data
```

### 3. Telegram WebApp Integration

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram

```javascript
// static/js/telegram-patch.js
const tg = window.Telegram?.WebApp;

// –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è WebApp
tg.ready();
tg.expand();
tg.enableClosingConfirmation();

// –û–±—Ä–∞–±–æ—Ç–∫–∞ back button –¥–ª—è –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –≤–∏–¥–µ–æ
tg.BackButton.onClick(() => {
    const streamPane = document.getElementById('md-pane-stream');
    if (streamPane && streamPane.classList.contains('fs-mode')) {
        streamPane.classList.remove('fs-mode');
        enableSwipes();
    }
});
```

### 4. Real-time –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: WebSocket-—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

```python
# optimizations/websocket_manager.py
class WebSocketManager:
    def notify_data_change(self, data_type: str, data: dict = None):
        """–£–≤–µ–¥–æ–º–ª—è–µ—Ç –≤—Å–µ—Ö –ø–æ–¥–∫–ª—é—á–µ–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π –æ–± –∏–∑–º–µ–Ω–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö"""
        message = {
            'type': 'data_update',
            'data_type': data_type,  # 'league_table', 'match_score', etc.
            'timestamp': data.get('updated_at', ''),
            'data': data
        }
        self.socketio.emit('data_update', message, broadcast=True)
```

### 5. –°–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏

### 6. –ü–æ–¥—Å–∏—Å—Ç–µ–º–∞ –Ω–æ–≤–æ—Å—Ç–µ–π
–ê–¥–º–∏–Ω CRUD: `GET/POST/PUT/DELETE /api/admin/news` (Telegram initData + —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ `ADMIN_USER_ID`).  
–ü—É–±–ª–∏—á–Ω–æ–µ API: `GET /api/news?limit=5&offset=0` (–∫—ç—à + ETag).  
–ö–ª—é—á–∏ –∫—ç—à–∞: `cache:news:limit:{L}:offset:{O}`.  
–ü–æ—Å–ª–µ –º—É—Ç–∞—Ü–∏–∏: `invalidate_pattern('cache:news')` + –ø—Ä–æ–≥—Ä–µ–≤ –±–∞–∑–æ–≤–æ–≥–æ —Å–µ–≥–º–µ–Ω—Ç–∞.

–ü—Ä–∏–º–µ—Ä –ø—É–±–ª–∏—á–Ω–æ–≥–æ –æ—Ç–≤–µ—Ç–∞:
```json
{"news":[{"id":1,"title":"–°—Ç–∞—Ä—Ç —Å–µ–∑–æ–Ω–∞","content":"...","created_at":"2025-09-02T10:00:00Z"}],"version":"md5hash"}
```

### 7. –°–µ–∑–æ–Ω–Ω—ã–π deep reset
–†–µ–∂–∏–º—ã: dry (–∞—É–¥–∏—Ç), soft (–ª—ë–≥–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫—ç—à–µ–π), full (–ø–µ—Ä–µ—Å–æ–∑–¥–∞–Ω–∏–µ —Å–µ–∑–æ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö), deep (full + —á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ Sheets + —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ + –ø—Ä–æ–≥—Ä–µ–≤).  
–ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è –Ω–∞ –∏–º–ø–æ—Ä—Ç —Ä–∞—Å–ø–∏—Å–∞–Ω–∏—è (–¥–æ ~300 —Å—Ç—Ä–æ–∫) –∏ –≤—ã–±–æ—Ä–æ—á–Ω–∞—è –æ—á–∏—Å—Ç–∫–∞ –∫–æ–ª–æ–Ω–æ–∫ B,D (–º–∏–Ω–∏–º–∏–∑–∞—Ü–∏—è –ø–æ—Ç–µ—Ä–∏ –≤—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö).

### 8. Snapshot —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏
`/api/stats-table` ‚Üí –µ—Å–ª–∏ snapshot –Ω–∞–π–¥–µ–Ω ‚Üí –æ—Ç–¥–∞—ë–º —Å ETag, –∏–Ω–∞—á–µ —Å–æ–±–∏—Ä–∞–µ–º –∏–∑ –∏–≥—Ä–æ–∫–æ–≤/—Å–æ–±—ã—Ç–∏–π. –ü–æ–∑–≤–æ–ª—è–µ—Ç –∏–∑–æ–ª–∏—Ä–æ–≤–∞—Ç—å —Ç—è–∂—ë–ª—É—é –∞–≥—Ä–µ–≥–∞—Ü–∏—é.
 
–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∞–≥—Ä–µ–≥–∞—Ü–∏–∏ TeamPlayerStats (2025-09-07)
- –í –Ω–∞–∫–æ–ø–∏—Ç–µ–ª–µ TeamPlayerStats –∫–ª—é—á–æ–º –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Ä–µ–∞–ª—å–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –∫–æ–º–∞–Ω–¥—ã (–∏–∑ –º–∞—Ç—á–∞), –∞ –Ω–µ –º–µ—Ç–∫–∏ 'home'/'away'. –≠—Ç–æ –∏—Å–∫–ª—é—á–∞–µ—Ç –¥—É–±–ª–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω—É—é —Å–µ–∑–æ–Ω–Ω—É—é –ø–µ—Ä—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç—å —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏.

### 9. ETag –ø–∞—Ç—Ç–µ—Ä–Ω
–°—Ç–∞–±–∏–ª—å–Ω–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è JSON (sort_keys) ‚Üí md5 ‚Üí `ETag` + `Cache-Control: public, max-age=120, stale-while-revalidate=60` (–Ω–æ–≤–æ—Å—Ç–∏) / –±–æ–ª–µ–µ –¥–ª–∏—Ç–µ–ª—å–Ω—ã–µ –¥–ª—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏. –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω–æ —Å–µ—Ä–≤–µ—Ä –¥–æ–±–∞–≤–ª—è–µ—Ç `X-Updated-At` –∫–∞–∫ –≤ 200, —Ç–∞–∫ –∏ –≤ 304, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç –º–æ–≥ –æ–±–Ω–æ–≤–∏—Ç—å –ª–µ–π–±–ª—ã —Å–≤–µ–∂–µ—Å—Ç–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ —Ç–µ–ª–∞.

### 10. –ü—Ä–æ–≥—Ä–µ–≤ –∫—ç—à–∞
–ü–æ—Å–ª–µ CRUD –Ω–æ–≤–æ—Å—Ç–µ–π –∏ deep reset ‚Äî —Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã–π –ø—Ä–æ–≥—Ä–µ–≤ –∫–ª—é—á–µ–≤—ã—Ö —Å—Ä–µ–∑–æ–≤ –¥–ª—è —Å–Ω–∏–∂–µ–Ω–∏—è –ª–∞—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –ø–µ—Ä–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞.

**–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è –∑–∞—â–∏—Ç–∞ –æ—Ç –∞—Ç–∞–∫ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

```python
# utils/security.py
class TelegramSecurity:
    def verify_init_data(self, init_data: str, bot_token: str) -> Optional[Dict]:
        """–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø–æ–¥–ª–∏–Ω–Ω–æ—Å—Ç–∏ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram WebApp"""
        try:
            parsed = parse_qs(init_data)
            hash_value = parsed.get('hash', [''])[0]
            
            # –°–æ–∑–¥–∞–µ–º —Å—Ç—Ä–æ–∫—É –¥–ª—è –ø—Ä–æ–≤–µ—Ä–∫–∏ –ø–æ–¥–ø–∏—Å–∏
            data_check_string = '\n'.join([f"{k}={v[0]}" for k, v in sorted(parsed.items()) if k != 'hash'])
            
            # –í—ã—á–∏—Å–ª—è–µ–º HMAC
            secret_key = hashlib.sha256(bot_token.encode()).digest()
            expected_hash = hmac.new(secret_key, data_check_string.encode(), hashlib.sha256).hexdigest()
            
            return expected_hash == hash_value
        except Exception:
            return False
```

## üìã –í—ã–≤–æ–¥—ã –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏

### –°–∏–ª—å–Ω—ã–µ —Å—Ç–æ—Ä–æ–Ω—ã (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)

1. **–ú–æ–¥—É–ª—å–Ω–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞** - —Ö–æ—Ä–æ—à–µ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏ –º–µ–∂–¥—É –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
2. **–ö–æ–º–ø–ª–µ–∫—Å–Ω–∞—è —Å–∏—Å—Ç–µ–º–∞ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏** - rate limiting, –≤–∞–ª–∏–¥–∞—Ü–∏—è, CSRF –∑–∞—â–∏—Ç–∞
3. **–ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å** - –º–Ω–æ–≥–æ—É—Ä–æ–≤–Ω–µ–≤–æ–µ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏–µ, –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤
4. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Telegram** - –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ WebApp API
5. **Real-time —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å** - WebSocket –¥–ª—è –∂–∏–≤—ã—Ö –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π
6. **–ì–∏–±–∫–∞—è —Å–∏—Å—Ç–µ–º–∞ —Å—Ç–∞–≤–æ–∫** - –ø–æ–¥–¥–µ—Ä–∂–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ç–∏–ø–æ–≤ —Å—Ç–∞–≤–æ–∫ –∏ —Ä—ã–Ω–∫–æ–≤

### –û–±–ª–∞—Å—Ç–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è (—Ä–∞—Å—à–∏—Ä–µ–Ω–æ)

1. **–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
   ```python
   # –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è: –î–æ–±–∞–≤–∏—Ç—å unit-—Ç–µ—Å—Ç—ã
   def test_betting_place():
       """–¢–µ—Å—Ç —Ä–∞–∑–º–µ—â–µ–Ω–∏—è —Å—Ç–∞–≤–∫–∏"""
       with app.test_client() as client:
           response = client.post('/api/betting/place', data={
               'market': '1x2',
               'selection': 'home',
               'stake': 100
           })
           assert response.status_code == 200
   ```

2. **TypeScript –º–∏–≥—Ä–∞—Ü–∏—è** —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥–∞.
3. **–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è API** (OpenAPI via apispec / flask-smorest).
4. **–°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ª–æ–≥–∏** + –∫–æ—Ä–µ–ª–ª—è—Ü–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤.
5. **CI/CD**: GitHub Actions (lint, tests, security scan).
6. **–î–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è app.py** –Ω–∞ –º–æ–¥—É–ª–∏ (news, season_reset, snapshots, auth).
7. **–í–∞–ª–∏–¥–∞—Ü–∏—è —Å—Ö–µ–º** (Pydantic / Marshmallow) –≤–º–µ—Å—Ç–æ —Ä—É—á–Ω–æ–π –ø—Ä–æ–≤–µ—Ä–∫–∏.
8. **Sanitization (bleach)** –¥–ª—è HTML –≤ –Ω–æ–≤–æ—Å—Ç—è—Ö.
9. **Alembic —Ä–µ–≤–∏–∑–∏–∏** ‚Äî –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞—Ç—å —Ç–µ–∫—É—â—É—é —Å—Ö–µ–º—É.
10. **Feature flags** —á–µ—Ä–µ–∑ ENV –¥–ª—è —ç–∫—Å–ø–µ—Ä–∏–º–µ–Ω—Ç–∞–ª—å–Ω—ã—Ö –ø–æ–¥—Å–∏—Å—Ç–µ–º.
11. –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏–∏ –∏–º—ë–Ω –∏–≥—Ä–æ–∫–æ–≤ (–≤—ã–Ω–µ—Å—Ç–∏ helper –≤–º–µ—Å—Ç–æ inline –∫–æ–¥–∞ –≤ endpoint —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è —Å–æ—Å—Ç–∞–≤–æ–≤).
12. –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π helper –¥–ª—è DB retry/backoff (–ø–∏–ª–æ—Ç —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω, –Ω—É–∂–Ω–æ –æ–±–æ–±—â–∏—Ç—å + —ç–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—É—é –∑–∞–¥–µ—Ä–∂–∫—É).
13. –ó–∞–≤–µ—Ä—à–∏—Ç—å –∑–∞–º–µ–Ω—É legacy –±–ª–æ–∫–æ–≤ match-details –Ω–∞ `fetchMatchDetails` (–ø–æ–∏—Å–∫ –ø–æ —Ä–µ–ø–æ: —Å—Ç–∞—Ä—ã–µ –ø—Ä—è–º—ã–µ fetch –∫ `/api/match-details`).
14. –ü—Ä–∏–º–µ–Ω–∏—Ç—å —Å–µ—Ä–≤–µ—Ä–Ω—ã–π `etag_json` –∫ `/api/schedule`, `/api/results`, `/api/match-details`.
15. –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å –≤—ã–∑–æ–≤—ã `splashStages.profile/data/finish` –≤ —Ä–µ–∞–ª—å–Ω—ã–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ –º–æ–¥—É–ª–µ–π (achievements, schedule, results, lineups) –≤–º–µ—Å—Ç–æ –∏—Å–∫—É—Å—Å—Ç–≤–µ–Ω–Ω–æ–≥–æ –∏–Ω—Ç–µ—Ä–≤–∞–ª–∞.

### –£—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
**Senior-friendly** - –ø—Ä–æ–µ–∫—Ç —Ç—Ä–µ–±—É–µ—Ç –≥–ª—É–±–æ–∫–æ–≥–æ –ø–æ–Ω–∏–º–∞–Ω–∏—è:
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã—Ö –ø–∞—Ç—Ç–µ—Ä–Ω–æ–≤
- –°–∏—Å—Ç–µ–º –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –∏ –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏–∏
- Integration —Å –≤–Ω–µ—à–Ω–∏–º–∏ API
- Real-time –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏

### –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–æ–ª–≥–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ)

1. **–ú–æ–Ω–æ–ª–∏—Ç app.py** ~9.6K —Å—Ç—Ä–æ–∫.
2. **Sheets –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å** (—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ) ‚Äî –Ω—É–∂–Ω–∞ –¥–µ–≥—Ä–∞–¥–∞—Ü–∏—è –ø—Ä–∏ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏ API + –ø–æ—Å—Ç–µ–ø–µ–Ω–Ω–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤ –ë–î.
3. **Retry / backoff** –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö —Å–µ—Ä–≤–∏—Å–æ–≤ –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç.
4. **–ò–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞** ‚Äî —Ä–∞–∑—Ä–æ–∑–Ω–µ–Ω–Ω—ã–µ –ø–∞—Ç—Ç–µ—Ä–Ω—ã, —Å—Ç–æ–∏—Ç —Ü–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞—Ç—å.
5. **–ù–µ—Ç —Ç–µ—Å—Ç–æ–≤–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è** (—Ñ–∏–∫—Å—Ç—É—Ä—ã Redis/Sheets).
6. **–û—Ç—Å—É—Ç—Å—Ç–≤—É—é—Ç Alembic —Ä–µ–≤–∏–∑–∏–∏** (—Ä–∏—Å–∫ –¥—Ä–µ–π—Ñ–∞ —Å—Ö–µ–º—ã) ‚Äî –æ—Å–æ–±–µ–Ω–Ω–æ –¥–ª—è –Ω–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü—ã `team_roster` (—Å–æ–∑–¥–∞—ë—Ç—Å—è ad-hoc).
7. **–û—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç sanitization –¥–ª—è –Ω–æ–≤–æ—Å—Ç–µ–π** (XSS —Ä–∏—Å–∫ –ø—Ä–∏ —Ä–µ–Ω–¥–µ—Ä–µ).
8. inline DDL (CREATE TABLE IF NOT EXISTS team_roster) –≤ –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–µ ‚Äî —Ç—Ä–µ–±—É–µ—Ç—Å—è –≤—ã–Ω–µ—Å—Ç–∏ –≤ –º–∏–≥—Ä–∞—Ü–∏—é.

## üîê –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
| –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è | –ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ | –û–±—è–∑–∞—Ç–µ–ª—å–Ω–æ |
|------------|------------|------------|
| `DATABASE_URL` | –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ PostgreSQL | –î–∞ |
| `REDIS_URL` | Redis –¥–ª—è –∫—ç—à–∞ | –ù–µ—Ç (fallback memory) |
| `BOT_TOKEN` | Telegram Bot —Ç–æ–∫–µ–Ω | –î–∞ |
| `ADMIN_USER_ID` | Telegram ID —Å—É–ø–µ—Ä-–∞–¥–º–∏–Ω–∞ | –î–∞ |
| `GOOGLE_SHEETS_KEY`/creds | –î–æ—Å—Ç—É–ø –∫ Sheets | –î–∞ (–¥–ª—è –∏–º–ø–æ—Ä—Ç–∞) |
| `SEASON_RESET_LOCK_TTL` | TTL –±–ª–æ–∫–∏—Ä–æ–≤–∫–∏ reset (–æ–ø—Ü.) | –ù–µ—Ç |

## üöÄ –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç (–∞–∫—Ç—É–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–æ)
```bash
pip install -r requirements.txt
export DATABASE_URL=postgresql+psycopg://user:pass@host/db
export BOT_TOKEN=123:abc
export ADMIN_USER_ID=123456789
python app.py  # –∏–ª–∏ gunicorn -w 1 -k geventwebsocket.gunicorn.workers.GeventWebSocketWorker wsgi:app
```

## ‚úÖ –ö–æ–Ω—Ç—Ä–æ–ª—å –∞–∫—Ç—É–∞–ª—å–Ω–æ—Å—Ç–∏
- News CRUD ‚Äî —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ –∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–æ.
- ETag `/api/news`, `/api/stats-table` ‚Äî —É—á—Ç–µ–Ω–æ.
- Deep reset ‚Äî –æ–ø–∏—Å–∞–Ω.
- –ü—Ä–æ–≥—Ä–µ–≤ –∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∫—ç—à–∞ ‚Äî –æ—Ç—Ä–∞–∂–µ–Ω–æ.
- DatabaseManager (lazy) ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–æ.
- Alembic ‚Äî –æ—Ç–º–µ—á–µ–Ω–æ (–Ω–µ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω).

### –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è JSON-–æ—Ç–≤–µ—Ç–æ–≤ (—Å–µ–Ω—Ç—è–±—Ä—å 2025)
- –í—Å–µ —Ç—è–∂—ë–ª—ã–µ –ø—É–±–ª–∏—á–Ω—ã–µ –∏ –∞–¥–º–∏–Ω—Å–∫–∏–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã, –≤–æ–∑–≤—Ä–∞—â–∞—é—â–∏–µ –±–æ–ª—å—à–∏–µ JSON, –ø–µ—Ä–µ–≤–µ–¥–µ–Ω—ã –Ω–∞ –±—ã—Å—Ç—Ä—ã–π —Ä–µ–Ω–¥–µ—Ä —á–µ—Ä–µ–∑ _json_response (orjson).
- –û—à–∏–±–æ—á–Ω—ã–µ –∏ –º–µ–ª–∫–∏–µ –æ—Ç–≤–µ—Ç—ã –æ—Å—Ç–∞–≤–ª–µ–Ω—ã –Ω–∞ jsonify –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏.
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω—ã —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ –∏ –≤—ã—Ä–∞–≤–Ω–∏–≤–∞–Ω–∏–µ try/except/finally –ø–æ—Å–ª–µ —Ä–µ—Ñ–∞–∫—Ç–æ—Ä–∏–Ω–≥–∞.

## üîÑ –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏ (—Ç–æ–ø‚Äë5)
1. –ó–∞–≤–µ—Ä—à–∏—Ç—å —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—é match-details (–≤—Å–µ –≤—ã–∑–æ–≤—ã ‚Üí `fetchMatchDetails`) –∏ –ø—Ä–∏–º–µ–Ω–∏—Ç—å `etag_json` –∫ schedule/results/match-details.
2. –í—ã–Ω–µ—Å—Ç–∏ news / reset / snapshots / roster (lineups) –∏–∑ `app.py` (–¥–µ–∫–æ–º–ø–æ–∑–∏—Ü–∏—è –º–æ–Ω–æ–ª–∏—Ç–∞).
3. –î–æ–±–∞–≤–∏—Ç—å bleach-sanitization –∫–æ–Ω—Ç–µ–Ω—Ç–∞ –Ω–æ–≤–æ—Å—Ç–µ–π (XSS –∑–∞—â–∏—Ç–∞ –ø–µ—Ä–µ–¥ –ø—É–±–ª–∏—á–Ω—ã–º —Ä–µ–Ω–¥–µ—Ä–æ–º).
4. –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞—Ç—å Alembic –∏ –ø–µ—Ä–≤—É—é —Ä–µ–≤–∏–∑–∏—é (–≤–∫–ª—é—á–∞—è `team_roster`).
5. –ù–∞—Å—Ç—Ä–æ–∏—Ç—å CI (lint + pytest stub) + –∫–∞—Ä–∫–∞—Å –¥–ª—è unit —Ç–µ—Å—Ç–æ–≤ —Å—Ç–∞–≤–æ–∫.
6. (–°–≤—è–∑–∞–Ω–æ) –¶–µ–Ω—Ç—Ä–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–π DB retry/backoff helper –∏ –∑–∞–º–µ–Ω–∞ –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ø–∏–ª–æ—Ç–∞.
7. –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è splashStages —Å–æ —Å—Ç–∞–¥–∏—è–º–∏ —Ñ–∞–∫—Ç–∏—á–µ—Å–∫–æ–π –∑–∞–≥—Ä—É–∑–∫–∏ (—É–±—Ä–∞—Ç—å ¬´—Ñ–∏–∫—Ç–∏–≤–Ω—ã–π¬ª –ø—Ä–æ–≥—Ä–µ—Å—Å —Ç–∞–º –≥–¥–µ –≤–æ–∑–º–æ–∂–Ω–æ).

---

–î–æ–∫—É–º–µ–Ω—Ç –æ–±–Ω–æ–≤–ª—ë–Ω –∏ —Ä–∞—Å—à–∏—Ä–µ–Ω –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–∏ —Å —Ç–µ–∫—É—â–∏–º —Å–æ—Å—Ç–æ—è–Ω–∏–µ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è.

–ü—Ä–æ–µ–∫—Ç –¥–µ–º–æ–Ω—Å—Ç—Ä–∏—Ä—É–µ—Ç **enterprise-—É—Ä–æ–≤–µ–Ω—å** —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ —Å –∞–∫—Ü–µ–Ω—Ç–æ–º –Ω–∞ –ø—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å –∏ –º–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–æ—Å—Ç—å.

## –ë—ã—Å—Ç—Ä—ã–µ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã: Real-time efficiency & UX (–∫—Ä–∞—Ç–∫–æ–µ —Ä–µ–∑—é–º–µ)

–¶–µ–ª—å: –º–≥–Ω–æ–≤–µ–Ω–Ω–∞—è –æ—Ç–∑—ã–≤—á–∏–≤–æ—Å—Ç—å –∫–ª–∏–µ–Ω—Ç–∞ –ø—Ä–∏ –º–∏–Ω–∏–º–∞–ª—å–Ω–æ–π –Ω–∞–≥—Ä—É–∑–∫–µ –Ω–∞ —Å–µ—Ä–≤–µ—Ä.

–¢–æ–ø‚Äë–ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—ã (MVP, 1‚Äì3 –Ω–µ–¥–µ–ª–∏):
- Topic-based WS subscriptions (match:{id}, team:{id}, leaderboard:{type}) ‚Äî —Å–µ–ª–µ–∫—Ç–∏–≤–Ω—ã–π broadcast.
- Redis pub/sub + per-topic routing ‚Äî –±—ã—Å—Ç—Ä–∞—è —Å–µ–ª–µ–∫—Ç–∏–≤–Ω–∞—è –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –∏ –Ω–æ—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è.
- Delta-encoding (patches) –¥–ª—è WS + MessagePack (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ) ‚Äî –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å —Ç–æ–ª—å–∫–æ –∏–∑–º–µ–Ω—ë–Ω–Ω—ã–µ –ø–æ–ª—è.
- Server-side batching (100‚Äì250ms) –¥–ª—è –º–µ–ª–∫–∏—Ö frequent-–∏–≤–µ–Ω—Ç–æ–≤ + QoS (high/low).
- Client optimistic updates + rollback –¥–ª—è –æ–ø–µ—Ä–∞—Ü–∏–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (—Å—Ç–∞–≤–∫–∏, —á–µ–∫-–∏–Ω).
- Observability: ETag hit ratio, WS msgs/min, median payload gen time, %304 ‚Äî –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –º–µ—Ç—Ä–∏–∫–∏ –¥–ª—è –ø—Ä–∏–Ω—è—Ç–∏—è —Ä–µ—à–µ–Ω–∏–π.

MVP —à–∞–≥–∏:
1. –í–Ω–µ–¥—Ä–∏—Ç—å topic routing + Redis listener ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –Ω–∞–±–æ—Ä —Å–µ—Ä–≤–µ—Ä–Ω—ã—Ö –∏–∑–º–µ–Ω–µ–Ω–∏–π.
2. –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å patch format –∏ –∫–ª–∏–µ–Ω—Ç—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ/—Ñ–æ–ª–ª–±–µ–∫ (resync –ø–æ ETag –ø—Ä–∏ reconnect).
3. –î–æ–±–∞–≤–∏—Ç—å batching –¥–ª—è match events –∏ –ø—Ä–∏–æ—Ä–∏—Ç–∏–∑–∞—Ü–∏—é –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö —Å–æ–±—ã—Ç–∏–π.
4. –í–∫–ª—é—á–∏—Ç—å –º–µ—Ç—Ä–∏–∫–∏ –∏ —Å–¥–µ–ª–∞—Ç—å –∫–∞–Ω–∞—Ä–µ–µ—á–Ω—ã–π rollout –Ω–æ–≤—ã—Ö –º–µ—Ö–∞–Ω–∏–∑–º–æ–≤.

–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞ (—á–µ—Ä–µ–∑ 2 –Ω–µ–¥–µ–ª–∏):
- –°–Ω–∏–∂–µ–Ω–∏–µ WS —Å–æ–æ–±—â–µ–Ω–∏–π/–º–∏–Ω –Ω–∞ ‚â•30% –ø—Ä–∏ —Å—Ç–∞–±–∏–ª—å–Ω–æ–º workload.
- ETag cache hit ratio > 70% –¥–ª—è –æ—Å–Ω–æ–≤–Ω—ã—Ö GET.
- Median generation time payload < 150ms –¥–ª—è –∫—Ä–∏—Ç–∏—á–Ω—ã—Ö endpoints.

